# 新潟市介護保険事業所システム - インフラ要件定義書

## 文書管理情報

| 項目 | 内容 |
|------|------|
| 文書名 | インフラ要件定義書 |
| バージョン | 1.0 |
| 作成日 | 2025-11-05 |
| 最終更新日 | 2025-11-05 |
| ステータス | 確定 |

---

## 目次

1. [プロジェクト概要](#1-プロジェクト概要)
2. [ビジネス要件](#2-ビジネス要件)
3. [技術要件](#3-技術要件)
4. [非機能要件](#4-非機能要件)
5. [ネットワーク要件](#5-ネットワーク要件)
6. [セキュリティ要件](#6-セキュリティ要件)
7. [運用要件](#7-運用要件)
8. [DR要件](#8-dr要件)
9. [コンプライアンス要件](#9-コンプライアンス要件)
10. [制約事項](#10-制約事項)

---

## 1. プロジェクト概要

### 1.1 プロジェクト名
**新潟市介護保険事業所システム - AWSインフラ構築**

### 1.2 目的
新潟市内の介護保険事業所向けのシステムをクラウド（AWS）上に構築し、従来のWindowsアプリケーションからWebアプリケーションへ移行する。
GCAS（政府情報システムのためのセキュリティ評価制度）に準拠した、高可用性・高セキュリティなインフラ環境を実現する。

### 1.3 対象システム
- **システム名**: 新潟市介護保険事業所システム
- **システム種別**: Webアプリケーション
- **既存システム**: Windowsアプリケーション（オンプレミス）
- **移行方針**: 新規構築（データ移行は別チーム担当、本プロジェクトのスコープ外）

### 1.4 プロジェクト期間
- **要件定義～設計**: 2025年11月～12月
- **構築**: 2026年1月～3月
- **テスト**: 2026年4月～5月
- **本番稼働**: 2026年6月（予定）

---

## 2. ビジネス要件

### 2.1 利用者
- **対象事業所数**: 約430事業所
- **対象職員数**: 1,300名以上
- **利用部署**: 新潟市福祉部介護保険課
- **利用場所**: 新潟市庁舎内、各介護事業所

### 2.2 業務要件
- 介護保険申請書類の電子化
- 申請状況の進捗管理
- 事業所情報の管理
- 統計データの集計・出力

### 2.3 利用シナリオ
- **通常時**: 平日9:00～18:00がピーク時間帯
- **繁忙期**: 月末・月初に利用集中
- **アクセス元**: 庁舎内職員端末、各事業所からのアクセス

---

## 3. 技術要件

### 3.1 アカウント構成

#### 3.1.1 AWS Organizations構成
```
AWS Organizations（管理アカウント）
│
├── 本番環境 OU
│   ├── 本番共通系アカウント
│   └── 本番アプリ系アカウント
│
└── ステージング環境 OU
    ├── ステージング共通系アカウント
    └── ステージングアプリ系アカウント
```

#### 3.1.2 各アカウントの責務

**本番共通系アカウント**
- ネットワークインフラ（Direct Connect、Transit Gateway）
- ログ集約（CloudWatch Logs）
- 監査ログ（CloudTrail、AWS Config）
- セキュリティサービス

**本番アプリ系アカウント**
- アプリケーションリソース（ECS、RDS、ElastiCache等）
- VPC（10.1.0.0/16）

**ステージング共通系アカウント**
- ネットワークインフラ（Transit Gateway接続）
- ログ集約

**ステージングアプリ系アカウント**
- アプリケーションリソース（T系インスタンス使用）
- VPC（10.2.0.0/16）

### 3.2 技術スタック

| レイヤー | 技術 | 備考 |
|---------|------|------|
| IaC | AWS CloudFormation | Infrastructure as Code |
| コンテナオーケストレーション | Amazon ECS | Fargate使用 |
| データベース | Amazon RDS MySQL | 本番: Multi-AZ、ステージング: Single-AZ |
| キャッシュ | Amazon ElastiCache | Redis |
| ストレージ | Amazon S3 | ドキュメント保管 |
| CDN | Amazon CloudFront | 静的コンテンツ配信 |
| ロードバランサー | Application Load Balancer | HTTPS終端 |
| DNS | Amazon Route 53 | 内部DNS |
| 監視 | Amazon CloudWatch | メトリクス、ログ、アラーム |
| ネットワーク | AWS Transit Gateway | アカウント間接続 |
| 接続 | AWS Direct Connect | 庁舎との専用線接続 |

### 3.3 環境構成

| 環境 | 用途 | コンピューティング | データベース |
|------|------|-------------------|--------------|
| 本番 | 本番稼働 | ECS Fargate（本番スペック） | RDS MySQL Multi-AZ |
| ステージング | 検証・テスト | ECS Fargate（T系） | RDS MySQL Single-AZ |

---

## 4. 非機能要件

### 4.1 性能要件

| 項目 | 目標値 | 測定方法 |
|------|--------|---------|
| 同時接続ユーザー数 | 100名 | CloudWatch同時接続数 |
| 応答時間（画面表示） | 3秒以内 | CloudWatch RUM |
| 応答時間（API） | 1秒以内 | CloudWatch メトリクス |
| データベースクエリ | 500ms以内 | RDS Performance Insights |
| ファイルダウンロード | 10秒以内（10MBファイル） | CloudFront + S3 |

### 4.2 可用性要件

| 項目 | 目標値 | 実現方法 |
|------|--------|---------|
| 稼働率 | 99.0%以上 | Multi-AZ構成、Auto Scaling |
| ダウンタイム許容 | 年間87.6時間以内 | 計画メンテナンス含む |
| 障害復旧時間（RTO） | 24時間以内 | Backup & Restore |
| データ損失許容（RPO） | 1時間以内 | 自動バックアップ（1時間間隔） |

### 4.3 拡張性要件

| 項目 | 初期想定 | 拡張計画 |
|------|---------|---------|
| 利用者数 | 1,300名 | 2,000名まで対応可能 |
| 同時接続数 | 100名 | 200名まで対応可能 |
| データ量 | 100GB | 500GBまで対応可能 |
| アカウント追加 | 4アカウント | Transit Gatewayで追加対応 |

---

## 5. ネットワーク要件

### 5.1 Direct Connect要件

| 項目 | 仕様 |
|------|------|
| 回線種別 | AWS Direct Connect |
| 回線速度 | 100Mbps |
| 回線数 | 2回線（冗長化） |
| 接続元 | 新潟市庁舎 |
| 接続先 | AWS東京リージョン（ap-northeast-1） |
| 共有方式 | Transit Gateway経由で本番・ステージング共有 |

### 5.2 VPC要件

#### 本番環境
- **CIDR**: 10.1.0.0/16
- **サブネット構成**:
  - Public Subnet（2AZ）
  - Private App Subnet（2AZ）
  - Private DB Subnet（2AZ）
  - Private Cache Subnet（2AZ）

#### ステージング環境
- **CIDR**: 10.2.0.0/16
- **サブネット構成**:
  - Public Subnet（2AZ）
  - Private App Subnet（2AZ）
  - Private DB Subnet（2AZ）

### 5.3 接続要件

| 接続元 | 接続先 | プロトコル | ポート |
|--------|--------|-----------|--------|
| 庁舎職員端末 | ALB | HTTPS | 443 |
| ECS | RDS | MySQL | 3306 |
| ECS | ElastiCache | Redis | 6379 |
| ECS | S3 | HTTPS | 443 |

---

## 6. セキュリティ要件

### 6.1 認証・認可

| 項目 | 要件 |
|------|------|
| ユーザー認証 | Amazon Cognito + MFA |
| MFA | 必須（GCAS準拠） |
| IAM | 最小権限の原則 |
| ロール管理 | AssumeRole使用 |
| アクセスキー | 原則禁止（GCAS準拠） |

### 6.2 暗号化

| 対象 | 暗号化方式 |
|------|----------|
| 通信（外部） | TLS 1.3 |
| 通信（内部） | TLS 1.2以上 |
| データベース | AWS KMS（保管時） |
| S3 | SSE-KMS |
| EBS | AWS KMS |
| バックアップ | AWS KMS |

### 6.3 ネットワークセキュリティ

| 項目 | 対策 |
|------|------|
| WAF | AWS WAF（OWASP Top 10対策） |
| DDoS対策 | AWS Shield Standard |
| セキュリティグループ | 最小権限ルール |
| NACL | サブネット境界防御 |
| VPC Flow Logs | 全トラフィック記録 |

### 6.4 監査・ログ

| 項目 | 要件 |
|------|------|
| API操作ログ | CloudTrail（全アカウント有効） |
| 構成変更履歴 | AWS Config |
| アクセスログ | ALB、S3、CloudFront |
| アプリケーションログ | CloudWatch Logs |
| ログ保持期間 | 90日間 |
| ログ集約 | 共通系アカウント |

---

## 7. 運用要件

### 7.1 監視要件

| 監視対象 | 監視項目 | 閾値 |
|---------|---------|------|
| ECS | CPU使用率 | 80%以上でアラート |
| ECS | メモリ使用率 | 80%以上でアラート |
| RDS | CPU使用率 | 80%以上でアラート |
| RDS | 接続数 | 最大接続数の80%以上 |
| ALB | 5xxエラー率 | 5%以上でアラート |
| ALB | レスポンスタイム | 3秒以上でアラート |

### 7.2 バックアップ要件

| 対象 | 頻度 | 保持期間 | バックアップ先 |
|------|------|---------|--------------|
| RDS | 自動バックアップ（1時間間隔） | 7日間 | 同一リージョン |
| RDS | スナップショット（日次） | 30日間 | クロスリージョン（大阪） |
| S3 | バージョニング有効 | 90日間 | クロスリージョン（大阪） |
| ECS設定 | CloudFormationテンプレート | Git管理 | GitHub |

### 7.3 メンテナンス要件

| 項目 | 頻度 | 実施時間帯 |
|------|------|-----------|
| RDSメンテナンス | 月次 | 日曜 3:00～5:00 |
| OSパッチ適用 | 月次 | 日曜 3:00～5:00 |
| セキュリティパッチ | 緊急時随時 | 調整の上実施 |

### 7.4 運用自動化

| 項目 | 自動化内容 |
|------|----------|
| スケーリング | ECS Auto Scaling（CPU/メモリベース） |
| バックアップ | AWS Backup自動実行 |
| パッチ適用 | AWS Systems Manager Patch Manager |
| 障害検知 | CloudWatch Alarms → SNS通知 |
| 一次調査 | Amazon Bedrock活用（将来対応） |

---

## 8. DR要件

### 8.1 DR戦略

| 項目 | 内容 |
|------|------|
| DR方式 | Backup & Restore |
| DRリージョン | 大阪リージョン（ap-northeast-3） |
| RTO（目標復旧時間） | 24時間以内 |
| RPO（目標復旧時点） | 1時間以内 |

### 8.2 DR手順

**平常時**
1. 日次で大阪リージョンへRDSスナップショットをコピー
2. S3クロスリージョンレプリケーション有効化
3. CloudFormationテンプレートをGitで管理

**災害発生時**
1. CloudFormationテンプレートのリージョンパラメータを変更（ap-northeast-1 → ap-northeast-3）
2. 大阪リージョンでCloudFormationスタック作成
3. RDSスナップショットから復元
4. S3レプリケーションバケットを参照
5. Route 53でDNSフェイルオーバー

### 8.3 DR訓練

| 項目 | 頻度 |
|------|------|
| DR訓練 | 年1回 |
| 訓練内容 | 大阪リージョンへの切り替え手順確認 |
| 訓練時間 | 半日程度 |

---

## 9. コンプライアンス要件

### 9.1 GCAS準拠

参照: https://guide.gcas.cloud.go.jp/aws/description-of-account-structure

| 項目 | 要件 |
|------|------|
| アカウント構成 | AWS Organizations使用 |
| MFA | 全IAMユーザーで必須 |
| アクセスキー | 原則禁止（デジタル庁承認時のみ） |
| 最小権限 | IAMロール・ポリシーで実現 |
| 監査ログ | CloudTrail全アカウント有効 |

### 9.2 個人情報保護

| 項目 | 対策 |
|------|------|
| 個人情報の暗号化 | KMS暗号化（保管時・転送時） |
| アクセス制御 | IAMポリシーで最小権限 |
| ログ監視 | 個人情報アクセスログの監視 |
| データ削除 | ライフサイクルポリシーで自動削除 |

### 9.3 その他準拠事項

| 項目 | 準拠レベル |
|------|----------|
| ISMS | 参考程度（必須ではない） |
| プライバシーマーク | 参考程度 |
| 自治体セキュリティポリシー | 新潟市の規定に準拠 |

---

## 10. 制約事項

### 10.1 スコープ外事項

| 項目 | 理由 |
|------|------|
| データ移行 | 別チーム担当 |
| アプリケーション開発 | 別チーム担当 |
| 既存Windowsアプリの保守 | 移行完了後廃止予定 |

### 10.2 技術的制約

| 項目 | 制約内容 |
|------|---------|
| リージョン | 東京リージョン（ap-northeast-1）のみ使用（DR時は大阪） |
| AZ | 東京リージョンの2AZを使用 |
| Direct Connect | 100Mbps × 2回線（帯域上限あり） |
| コスト | 予算内での構築（見積もり後確定） |

### 10.3 運用制約

| 項目 | 制約内容 |
|------|---------|
| メンテナンス時間 | 日曜 3:00～5:00のみ |
| サポート窓口 | 平日 9:00～18:00 |
| 緊急対応 | 24時間365日（重大障害のみ） |

---

## 改訂履歴

| バージョン | 日付 | 改訂内容 | 承認者 |
|-----------|------|---------|--------|
| 1.0 | 2025-11-05 | 初版作成 | - |

---

**以上**
