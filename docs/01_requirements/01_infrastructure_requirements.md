# インフラストラクチャ要件定義書

## 1. 文書管理情報

| 項目 | 内容 |
|------|------|
| 文書名 | 新潟市介護保険事業所システム インフラストラクチャ要件定義書 |
| 版数 | 1.0 |
| 作成日 | 2025-01-04 |
| 最終更新日 | 2025-01-04 |
| ステータス | Draft |

## 2. プロジェクト概要

### 2.1 プロジェクト名
新潟市介護保険事業所システム導入業務

### 2.2 目的
標準化介護保険システムへの移行に伴い、介護保険事業所等が使用するシステムを新規構築し、現行の業務フローを維持しながら、利便性とサービス品質を向上させる。

### 2.3 期間
- **構築期間**: 令和8年1月～令和9年1月3日
- **運用保守期間**: 令和9年1月4日～令和13年3月31日（4年3ヶ月）

### 2.4 予算
- **導入費用**: 210,000,000円（税込）
- **運用保守費用**: 242,590,000円（51ヶ月分）

## 3. ビジネス要件

### 3.1 対象ユーザー
| ユーザー種別 | 人数 | アクセス元 |
|------------|------|-----------|
| 介護保険事業所等側利用者 | 約1,300名（約430事業所） | インターネット |
| 職員側利用者 | 約30名 | LGWAN/インターネット |
| 事務センター従業員 | 約5～10名 | LGWAN/VPN |

### 3.2 利用シーン
- 要介護認定申請の登録・管理
- 認定調査票の作成・提出
- 基本チェックリストの提出
- ケアプラン届の提出
- 高齢者福祉サービス申請
- 対象者情報の閲覧
- 過去の審査会資料の閲覧

## 4. 機能要件

### 4.1 システム構成要件
| 項目 | 要件 |
|------|------|
| アプリケーション基盤 | コンテナベース（ECS Fargate） |
| データベース | RDS PostgreSQL（Multi-AZ） |
| ファイルストレージ | S3（バージョニング有効） |
| CDN | CloudFront |
| API Gateway | Application Load Balancer |
| コンテナレジストリ | ECR |

### 4.2 アプリケーション要件
| 項目 | 要件 |
|------|------|
| フロントエンド | React + TypeScript（SPA） |
| バックエンド | Node.js + Express |
| 認証 | Cognito（二要素認証対応） |
| OCR処理 | Textract |
| ファイル無害化 | Lambda + サードパーティAPI |

## 5. 非機能要件

### 5.1 性能要件
| 項目 | 要件値 | 備考 |
|------|--------|------|
| サービス稼働率 | 99.0%以上 | 月間ダウンタイム 7.2時間以内 |
| オンライン応答時間 | 3秒以内（原則） | バッチ処理・一覧検索除く |
| 同時接続ユーザー数 | 100接続 | 業務に支障なく使用可能 |
| 障害復旧時間（RTO） | 24時間以内 | ハードウェア障害除く |
| 障害復旧ポイント（RPO） | 1日以内 | 日次バックアップ |

### 5.2 拡張性要件
| 項目 | 要件 |
|------|------|
| 利用者数の増加 | 初期の2倍まで対応可能 |
| データ量の増加 | 10年分のデータ蓄積に対応 |
| 機能追加 | API経由での機能拡張が可能 |
| 一時的な負荷増加 | 月初の申請集中に対応（Auto Scaling） |

### 5.3 可用性要件
| 項目 | 要件 |
|------|------|
| Multi-AZ構成 | 必須 |
| 自動フェイルオーバー | RDS、ECS共に対応 |
| ヘルスチェック | ALB、ECS共に実装 |
| データレプリケーション | RDS Multi-AZ、S3クロスリージョンレプリケーション |

### 5.4 セキュリティ要件

#### 5.4.1 準拠基準
| 基準 | 対応 |
|------|------|
| GCAS（政府情報システムのためのセキュリティ評価制度） | 必須 |
| プライバシーマーク | 取得済み |
| ISMS（ISO/IEC 27001） | 取得済み |
| 地方公共団体情報セキュリティポリシーガイドライン | 準拠 |
| 医療情報システムの安全管理に関するガイドライン第6.0版 | 参考 |

#### 5.4.2 ネットワークセキュリティ
| 項目 | 要件 |
|------|------|
| 通信暗号化 | TLS 1.2以上 |
| VPC設計 | パブリック/プライベートサブネット分離 |
| Direct Connect | 庁舎からの専用線接続 |
| WAF | CloudFront、ALB共に有効化 |
| DDoS対策 | AWS Shield Standard（自動有効） |

#### 5.4.3 アクセス制御
| 項目 | 要件 |
|------|------|
| 多要素認証（MFA） | 全ユーザー必須 |
| IAMポリシー | 最小権限の原則 |
| アクセスログ | CloudTrail、VPC Flow Logs |
| セッション管理 | タイムアウト30分 |

#### 5.4.4 データ保護
| 項目 | 要件 |
|------|------|
| データベース暗号化 | RDS暗号化（KMS） |
| ファイル暗号化 | S3暗号化（KMS） |
| バックアップ暗号化 | 全バックアップ暗号化 |
| データ削除 | 論理削除 + 物理削除（保存期間経過後） |

#### 5.4.5 監査・ログ
| 項目 | 要件 |
|------|------|
| 操作ログ | 全API操作を記録 |
| アクセスログ | 全アクセスを記録 |
| エラーログ | 全エラーを記録 |
| ログ保存期間 | 最低5年以上 |
| ログ改ざん防止 | CloudWatch Logs Insights、S3オブジェクトロック |

### 5.5 バックアップ要件
| 項目 | 要件 |
|------|------|
| バックアップ頻度 | 1日1回以上 |
| バックアップ保存期間 | 最低5年以上 |
| バックアップ範囲 | RDS、S3、設定情報 |
| リストア訓練 | 年2回実施 |
| ランサムウェア対策 | バックアップの物理的隔離（S3 Glacier） |

### 5.6 監視要件
| 項目 | 要件 |
|------|------|
| リソース監視 | CPU、メモリ、ディスク、ネットワーク |
| アプリケーション監視 | エラー率、レイテンシ、スループット |
| ログ監視 | エラーログ、アクセスログ |
| セキュリティ監視 | GuardDuty、Security Hub |
| アラート通知 | メール、Slack |

## 6. インフラストラクチャアーキテクチャ要件

### 6.1 AWS組織構成
```
niigatacity-org (AWS Organizations)
├── common-account (共通系アカウント)
│   ├── Direct Connect
│   ├── Transit Gateway
│   ├── Route 53 (プライベートホストゾーン)
│   └── Network Firewall
├── prod-account (本番アカウント)
│   ├── VPC
│   ├── ECS Fargate
│   ├── RDS PostgreSQL (Multi-AZ)
│   ├── S3
│   ├── CloudFront
│   └── Cognito
├── staging-account (ステージングアカウント)
│   ├── VPC
│   ├── ECS Fargate (T系インスタンス)
│   ├── RDS PostgreSQL (Single-AZ)
│   ├── S3
│   └── Cognito
└── operations-account (運用アカウント)
    ├── CloudWatch Logs集約
    ├── S3 (バックアップ集約)
    ├── Lambda (Bedrock運用自動化)
    └── Security Hub集約
```

### 6.2 ネットワーク構成
| 項目 | 要件 |
|------|------|
| VPC CIDR（本番） | 10.0.0.0/16 |
| VPC CIDR（ステージング） | 10.1.0.0/16 |
| パブリックサブネット | 2 AZ × 2環境 |
| プライベートサブネット（アプリ） | 2 AZ × 2環境 |
| プライベートサブネット（DB） | 2 AZ × 2環境 |
| Direct Connect | 1Gbps × 1本 + バックアップ回線 |
| Transit Gateway | 共通系アカウントに配置 |

### 6.3 コンピューティング構成
| 項目 | 本番環境 | ステージング環境 |
|------|---------|-----------------|
| ECS起動タイプ | Fargate | Fargate |
| CPU | 2 vCPU | 1 vCPU (T系) |
| メモリ | 4 GB | 2 GB |
| タスク数（最小） | 2 | 1 |
| タスク数（最大） | 10 | 2 |
| Auto Scaling | 有効 | 有効 |

### 6.4 データベース構成
| 項目 | 本番環境 | ステージング環境 |
|------|---------|-----------------|
| エンジン | PostgreSQL 15 | PostgreSQL 15 |
| インスタンスタイプ | db.r6g.large | db.t4g.medium |
| Multi-AZ | 有効 | 無効 |
| 自動バックアップ | 35日間 | 7日間 |
| Read Replica | 1台 | なし |
| 暗号化 | 有効（KMS） | 有効（KMS） |

### 6.5 ストレージ構成
| 項目 | 要件 |
|------|------|
| アプリケーションファイル | S3（標準ストレージ） |
| バックアップ | S3（Glacier） |
| ログ | S3（Intelligent-Tiering） |
| バージョニング | 有効 |
| ライフサイクル | 90日後にIA、1年後にGlacier |
| クロスリージョンレプリケーション | 有効（大阪リージョン） |

## 7. GCAS準拠要件

### 7.1 GCAS対応項目
| 管理策 | 対応内容 |
|--------|---------|
| 組織的対策 | AWS Organizationsによる統制 |
| 人的対策 | IAMポリシーによる最小権限 |
| 物理的対策 | AWSデータセンター（国内リージョン） |
| 技術的対策 | 暗号化、監視、ログ管理 |

### 7.2 コンプライアンス
| 項目 | 対応 |
|------|------|
| AWS リージョン | 東京リージョン（ap-northeast-1） |
| データレジデンシー | 国内に限定 |
| SOC 2 Type II | AWS準拠済み |
| ISO/IEC 27001 | AWS準拠済み |
| ISO/IEC 27017 | AWS準拠済み |
| ISO/IEC 27018 | AWS準拠済み |

## 8. 運用要件

### 8.1 監視項目
| カテゴリ | 監視項目 |
|---------|---------|
| インフラ | CPU使用率、メモリ使用率、ディスク使用率、ネットワークトラフィック |
| アプリケーション | エラー率、レイテンシ、スループット、タスク起動数 |
| データベース | CPU使用率、接続数、レプリケーション遅延、ストレージ使用率 |
| セキュリティ | GuardDuty検知、Security Hub検知、不正アクセス |

### 8.2 アラート基準
| 監視項目 | 警告閾値 | 危機閾値 | 通知先 |
|---------|---------|---------|--------|
| CPU使用率 | 70% | 90% | 運用チーム |
| メモリ使用率 | 70% | 90% | 運用チーム |
| ディスク使用率 | 70% | 85% | 運用チーム |
| エラー率 | 5% | 10% | 開発チーム + 運用チーム |
| レスポンスタイム | 2秒 | 5秒 | 開発チーム + 運用チーム |

### 8.3 パッチ適用
| 対象 | 適用頻度 | 適用方法 |
|------|---------|---------|
| OS | 月次 | ECSタスク定義更新 |
| ミドルウェア | 月次 | コンテナイメージ更新 |
| RDS | 月次 | メンテナンスウィンドウ |
| アプリケーション | 随時 | CI/CD |

### 8.4 Bedrock活用（運用自動化）
| 用途 | 内容 |
|------|------|
| 障害一次調査 | CloudWatch Logsを解析し、障害の原因を推定 |
| 対応方法提案 | 過去の対応履歴から最適な対応方法を提案 |
| ドキュメント生成 | 障害レポート、対応手順書の自動生成 |
| 質問応答 | 運用手順、設定情報の質問応答 |

## 9. CI/CD要件

### 9.1 CI/CDツール
| 項目 | ツール |
|------|--------|
| ソースコード管理 | GitHub |
| CI/CDパイプライン | GitHub Actions |
| IaCツール | Terraform |
| コンテナイメージビルド | Docker（GitHub Actions） |
| 脆弱性スキャン | Trivy、Snyk |

### 9.2 デプロイフロー
```
開発ブランチ → Pull Request → terraform plan → レビュー → mainマージ → terraform apply → 本番デプロイ
```

### 9.3 承認フロー
| 環境 | 承認者 | 承認方法 |
|------|-------|---------|
| ステージング | 開発リーダー | GitHub Pull Request |
| 本番 | プロジェクトマネージャー | GitHub Pull Request + Manual Approval |

## 10. 災害対策要件

### 10.1 バックアップ
| 対象 | バックアップ方式 | 保存先 | 保存期間 |
|------|-----------------|--------|---------|
| RDS | 自動バックアップ + スナップショット | 東京リージョン + 大阪リージョン | 35日間 |
| S3 | バージョニング + クロスリージョンレプリケーション | 東京リージョン + 大阪リージョン | 無期限 |
| 設定情報 | Terraform State | S3（バージョニング有効） | 無期限 |

### 10.2 DR（災害復旧）
| 項目 | 要件 |
|------|------|
| DR戦略 | Warm Standby（大阪リージョン） |
| RTO | 24時間以内 |
| RPO | 1日以内 |
| フェイルオーバー訓練 | 年1回 |

## 11. コスト要件

### 11.1 コスト最適化施策
| 施策 | 内容 |
|------|------|
| ステージング環境のコスト削減 | T系インスタンス、Single-AZ、夜間停止 |
| S3ストレージクラス | Intelligent-Tiering、Glacier活用 |
| Reserved Instance | RDS本番環境で1年リザーブド |
| Savings Plans | Compute Savings Plans（1年） |
| 自動停止 | ステージング環境の夜間・休日停止 |

### 11.2 コスト見積もり（月額）
| 項目 | 本番環境 | ステージング環境 | 運用アカウント | 合計 |
|------|---------|-----------------|---------------|------|
| ECS Fargate | $150 | $30 | - | $180 |
| RDS | $300 | $50 | - | $350 |
| S3 | $50 | $10 | $100 | $160 |
| CloudFront | $100 | - | - | $100 |
| Direct Connect | $200 | - | - | $200 |
| その他 | $100 | $20 | $50 | $170 |
| **合計** | **$900** | **$110** | **$150** | **$1,160** |

※ 為替レート: $1 = ¥140 として、月額約 ¥162,400

## 12. 制約事項

### 12.1 技術的制約
- AWSリージョンは東京リージョン（ap-northeast-1）に限定
- データは国内に限定（データレジデンシー要件）
- Direct Connectは既存回線を利用（帯域: 1Gbps）

### 12.2 運用制約
- メンテナンスウィンドウ: 毎週日曜日 3:00-5:00
- 本番環境への変更は承認必須
- ステージング環境は本番環境と同一構成を維持

### 12.3 スケジュール制約
- 令和8年10月: ステージング環境稼働
- 令和9年1月3日: 本番環境稼働

## 13. 参考資料

- [政府情報システムのためのセキュリティ評価制度（GCAS）](https://guide.gcas.cloud.go.jp/)
- [地方公共団体における情報セキュリティポリシーに関するガイドライン](https://www.soumu.go.jp/)
- [医療情報システムの安全管理に関するガイドライン第6.0版](https://www.mhlw.go.jp/)
- [AWS Well-Architected Framework](https://aws.amazon.com/architecture/well-architected/)
- [AWS セキュリティベストプラクティス](https://aws.amazon.com/security/best-practices/)

## 14. 改訂履歴

| 版数 | 日付 | 改訂内容 | 作成者 |
|------|------|---------|--------|
| 1.0 | 2025-01-04 | 初版作成 | AI開発ファシリテーター |

---
**文書終了**
