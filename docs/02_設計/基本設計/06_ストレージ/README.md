# 06. ストレージ設計

## 概要

新潟市介護保険サブシステムのストレージ（S3、EFS）設計ドキュメントです。

## ドキュメント構成

| ドキュメント | 概要 | ページ数 |
|------------|------|---------|
| [storage_design.md](./storage_design.md) | ストレージ設計全体 | 15ページ |
| [s3_lifecycle_policy.json](./s3_lifecycle_policy.json) | S3ライフサイクルポリシー定義 | - |

## 主要な設計判断

### S3バケット戦略

1. **用途別バケット分離**
   - アプリケーションログ
   - 監査ログ
   - バックアップ
   - アーカイブ

2. **ライフサイクル管理**
   - アプリログ: 90日後削除
   - 監査ログ: 7年保管（Glacier移行）
   - バックアップ: 30日後Glacier、365日後削除

3. **セキュリティ**
   - KMS暗号化必須
   - バージョニング有効
   - 監査ログはオブジェクトロック（COMPLIANCE モード）

### EFS設計

1. **パフォーマンスモード**
   - 汎用 (General Purpose)
   - バーストスループット

2. **ライフサイクル管理**
   - 30日間アクセスなしで Standard-IA へ移行
   - 85% コスト削減

3. **バックアップ**
   - AWS Backup による毎日バックアップ（本番）
   - 30日間保持

## クロスリージョンレプリケーション

- **対象**: バックアップバケットのみ
- **レプリケーション先**: us-west-2 (DR環境)
- **暗号化**: レプリケーション先も KMS 暗号化

## コスト見積もり

| 環境 | 月額費用 |
|------|---------|
| 本番 | $79.54 |
| ステージング | $11.63 |
| **合計** | **$91.17** |

## 関連ドキュメント

- [セキュリティ設計](../07_security/security_design.md)
- [バックアップ設計](../09_backup_dr/backup_dr_design.md)
- [監視設計](../08_monitoring/monitoring_design.md)

---

**作成日**: 2025-11-05
**作成者**: Architect
