{
  "ECSTaskExecutionRolePolicy": {
    "Version": "2012-10-17",
    "Statement": [
      {
        "Sid": "ECRAccess",
        "Effect": "Allow",
        "Action": [
          "ecr:GetAuthorizationToken",
          "ecr:BatchCheckLayerAvailability",
          "ecr:GetDownloadUrlForLayer",
          "ecr:BatchGetImage"
        ],
        "Resource": "*"
      },
      {
        "Sid": "CloudWatchLogsAccess",
        "Effect": "Allow",
        "Action": [
          "logs:CreateLogStream",
          "logs:PutLogEvents"
        ],
        "Resource": "arn:aws:logs:us-east-1:123456789012:log-group:/ecs/kaigo-subsys-prod:*"
      },
      {
        "Sid": "SecretsManagerAccess",
        "Effect": "Allow",
        "Action": [
          "secretsmanager:GetSecretValue"
        ],
        "Resource": [
          "arn:aws:secretsmanager:us-east-1:123456789012:secret:kaigo-subsys/prod/db-password-*",
          "arn:aws:secretsmanager:us-east-1:123456789012:secret:kaigo-subsys/prod/redis-password-*"
        ]
      },
      {
        "Sid": "SSMParameterAccess",
        "Effect": "Allow",
        "Action": [
          "ssm:GetParameters",
          "ssm:GetParameter"
        ],
        "Resource": "arn:aws:ssm:us-east-1:123456789012:parameter/kaigo-subsys/prod/*"
      },
      {
        "Sid": "KMSDecryptAccess",
        "Effect": "Allow",
        "Action": [
          "kms:Decrypt",
          "kms:DescribeKey"
        ],
        "Resource": [
          "arn:aws:kms:us-east-1:123456789012:key/*"
        ],
        "Condition": {
          "StringEquals": {
            "kms:ViaService": [
              "secretsmanager.us-east-1.amazonaws.com",
              "ssm.us-east-1.amazonaws.com"
            ]
          }
        }
      }
    ]
  },
  "ECSTaskRolePolicy": {
    "Version": "2012-10-17",
    "Statement": [
      {
        "Sid": "S3AppLogsAccess",
        "Effect": "Allow",
        "Action": [
          "s3:PutObject",
          "s3:GetObject",
          "s3:ListBucket"
        ],
        "Resource": [
          "arn:aws:s3:::kaigo-subsys-prod-app-logs",
          "arn:aws:s3:::kaigo-subsys-prod-app-logs/*"
        ]
      },
      {
        "Sid": "S3BackupReadAccess",
        "Effect": "Allow",
        "Action": [
          "s3:GetObject",
          "s3:ListBucket"
        ],
        "Resource": [
          "arn:aws:s3:::kaigo-subsys-prod-backups",
          "arn:aws:s3:::kaigo-subsys-prod-backups/*"
        ]
      },
      {
        "Sid": "KMSDecryptAccess",
        "Effect": "Allow",
        "Action": [
          "kms:Decrypt",
          "kms:DescribeKey"
        ],
        "Resource": [
          "arn:aws:kms:us-east-1:123456789012:key/*"
        ],
        "Condition": {
          "StringEquals": {
            "kms:ViaService": [
              "s3.us-east-1.amazonaws.com",
              "rds.us-east-1.amazonaws.com",
              "elasticache.us-east-1.amazonaws.com"
            ]
          }
        }
      },
      {
        "Sid": "CloudWatchMetricsAccess",
        "Effect": "Allow",
        "Action": [
          "cloudwatch:PutMetricData"
        ],
        "Resource": "*",
        "Condition": {
          "StringEquals": {
            "cloudwatch:namespace": "KaigoSubsystem"
          }
        }
      },
      {
        "Sid": "XRayAccess",
        "Effect": "Allow",
        "Action": [
          "xray:PutTraceSegments",
          "xray:PutTelemetryRecords"
        ],
        "Resource": "*"
      }
    ]
  },
  "LambdaBackupRolePolicy": {
    "Version": "2012-10-17",
    "Statement": [
      {
        "Sid": "RDSSnapshotAccess",
        "Effect": "Allow",
        "Action": [
          "rds:DescribeDBSnapshots",
          "rds:CopyDBSnapshot",
          "rds:DeleteDBSnapshot",
          "rds:AddTagsToResource",
          "rds:ListTagsForResource"
        ],
        "Resource": "*"
      },
      {
        "Sid": "S3BackupAccess",
        "Effect": "Allow",
        "Action": [
          "s3:PutObject",
          "s3:GetObject",
          "s3:ListBucket"
        ],
        "Resource": [
          "arn:aws:s3:::kaigo-subsys-prod-backups",
          "arn:aws:s3:::kaigo-subsys-prod-backups/*"
        ]
      },
      {
        "Sid": "KMSEncryptDecrypt",
        "Effect": "Allow",
        "Action": [
          "kms:Decrypt",
          "kms:Encrypt",
          "kms:GenerateDataKey",
          "kms:DescribeKey"
        ],
        "Resource": [
          "arn:aws:kms:us-east-1:123456789012:key/backup-key-id"
        ]
      },
      {
        "Sid": "SNSPublishAccess",
        "Effect": "Allow",
        "Action": [
          "sns:Publish"
        ],
        "Resource": "arn:aws:sns:us-east-1:123456789012:kaigo-subsys-prod-backup-notifications"
      },
      {
        "Sid": "CloudWatchLogsAccess",
        "Effect": "Allow",
        "Action": [
          "logs:CreateLogGroup",
          "logs:CreateLogStream",
          "logs:PutLogEvents"
        ],
        "Resource": "arn:aws:logs:us-east-1:123456789012:log-group:/aws/lambda/kaigo-subsys-prod-backup:*"
      }
    ]
  },
  "AdminGroupPolicy": {
    "Version": "2012-10-17",
    "Statement": [
      {
        "Sid": "FullAdminAccess",
        "Effect": "Allow",
        "Action": "*",
        "Resource": "*",
        "Condition": {
          "StringEquals": {
            "aws:RequestedRegion": [
              "us-east-1",
              "us-west-2"
            ]
          }
        }
      },
      {
        "Sid": "DenyRootAccountUsage",
        "Effect": "Deny",
        "Action": "*",
        "Resource": "*",
        "Condition": {
          "StringLike": {
            "aws:PrincipalArn": "arn:aws:iam::*:root"
          }
        }
      }
    ]
  },
  "DeveloperGroupPolicy": {
    "Version": "2012-10-17",
    "Statement": [
      {
        "Sid": "StagingFullAccess",
        "Effect": "Allow",
        "Action": "*",
        "Resource": "*",
        "Condition": {
          "StringEquals": {
            "aws:ResourceTag/Environment": "staging"
          }
        }
      },
      {
        "Sid": "ProductionReadOnlyAccess",
        "Effect": "Allow",
        "Action": [
          "ec2:Describe*",
          "ecs:Describe*",
          "ecs:List*",
          "rds:Describe*",
          "elasticache:Describe*",
          "logs:Describe*",
          "logs:Get*",
          "logs:FilterLogEvents",
          "cloudwatch:Describe*",
          "cloudwatch:Get*",
          "cloudwatch:List*",
          "s3:ListBucket",
          "s3:GetObject"
        ],
        "Resource": "*",
        "Condition": {
          "StringEquals": {
            "aws:ResourceTag/Environment": "production"
          }
        }
      },
      {
        "Sid": "DenyProductionModification",
        "Effect": "Deny",
        "Action": [
          "ec2:*",
          "ecs:Update*",
          "ecs:Delete*",
          "ecs:Stop*",
          "rds:Modify*",
          "rds:Delete*",
          "elasticache:Modify*",
          "elasticache:Delete*",
          "s3:PutObject",
          "s3:DeleteObject"
        ],
        "Resource": "*",
        "Condition": {
          "StringEquals": {
            "aws:ResourceTag/Environment": "production"
          }
        }
      }
    ]
  },
  "AuditorGroupPolicy": {
    "Version": "2012-10-17",
    "Statement": [
      {
        "Sid": "CloudTrailReadAccess",
        "Effect": "Allow",
        "Action": [
          "cloudtrail:LookupEvents",
          "cloudtrail:GetEventSelectors",
          "cloudtrail:DescribeTrails"
        ],
        "Resource": "*"
      },
      {
        "Sid": "S3AuditLogsReadAccess",
        "Effect": "Allow",
        "Action": [
          "s3:GetObject",
          "s3:ListBucket"
        ],
        "Resource": [
          "arn:aws:s3:::kaigo-subsys-prod-audit-logs",
          "arn:aws:s3:::kaigo-subsys-prod-audit-logs/*"
        ]
      },
      {
        "Sid": "CloudWatchLogsReadAccess",
        "Effect": "Allow",
        "Action": [
          "logs:DescribeLogGroups",
          "logs:DescribeLogStreams",
          "logs:GetLogEvents",
          "logs:FilterLogEvents"
        ],
        "Resource": "*"
      },
      {
        "Sid": "ConfigReadAccess",
        "Effect": "Allow",
        "Action": [
          "config:Get*",
          "config:Describe*",
          "config:List*"
        ],
        "Resource": "*"
      },
      {
        "Sid": "SecurityHubReadAccess",
        "Effect": "Allow",
        "Action": [
          "securityhub:Get*",
          "securityhub:Describe*",
          "securityhub:List*"
        ],
        "Resource": "*"
      },
      {
        "Sid": "DenyModification",
        "Effect": "Deny",
        "Action": [
          "s3:PutObject",
          "s3:DeleteObject",
          "logs:PutLogEvents",
          "logs:DeleteLogGroup",
          "logs:DeleteLogStream"
        ],
        "Resource": "*"
      }
    ]
  },
  "OperatorGroupPolicy": {
    "Version": "2012-10-17",
    "Statement": [
      {
        "Sid": "ECSDeployAccess",
        "Effect": "Allow",
        "Action": [
          "ecs:UpdateService",
          "ecs:DescribeServices",
          "ecs:DescribeTasks",
          "ecs:ListTasks",
          "ecs:RegisterTaskDefinition",
          "ecs:DeregisterTaskDefinition"
        ],
        "Resource": "*",
        "Condition": {
          "StringEquals": {
            "aws:ResourceTag/Environment": [
              "production",
              "staging"
            ]
          }
        }
      },
      {
        "Sid": "CloudWatchAccess",
        "Effect": "Allow",
        "Action": [
          "cloudwatch:*",
          "logs:*"
        ],
        "Resource": "*"
      },
      {
        "Sid": "RDSOperationalAccess",
        "Effect": "Allow",
        "Action": [
          "rds:DescribeDBInstances",
          "rds:DescribeDBSnapshots",
          "rds:CreateDBSnapshot",
          "rds:RestoreDBInstanceFromDBSnapshot"
        ],
        "Resource": "*"
      },
      {
        "Sid": "DenyDangerousOperations",
        "Effect": "Deny",
        "Action": [
          "rds:DeleteDBInstance",
          "rds:ModifyDBInstance",
          "ec2:TerminateInstances",
          "s3:DeleteBucket"
        ],
        "Resource": "*",
        "Condition": {
          "StringEquals": {
            "aws:ResourceTag/Environment": "production"
          }
        }
      }
    ]
  },
  "VPCFlowLogsRolePolicy": {
    "Version": "2012-10-17",
    "Statement": [
      {
        "Sid": "CloudWatchLogsAccess",
        "Effect": "Allow",
        "Action": [
          "logs:CreateLogGroup",
          "logs:CreateLogStream",
          "logs:PutLogEvents",
          "logs:DescribeLogGroups",
          "logs:DescribeLogStreams"
        ],
        "Resource": "arn:aws:logs:us-east-1:123456789012:log-group:/aws/vpc/flowlogs:*"
      }
    ]
  },
  "S3ReplicationRolePolicy": {
    "Version": "2012-10-17",
    "Statement": [
      {
        "Sid": "SourceBucketAccess",
        "Effect": "Allow",
        "Action": [
          "s3:GetReplicationConfiguration",
          "s3:ListBucket"
        ],
        "Resource": "arn:aws:s3:::kaigo-subsys-prod-backups"
      },
      {
        "Sid": "SourceObjectAccess",
        "Effect": "Allow",
        "Action": [
          "s3:GetObjectVersionForReplication",
          "s3:GetObjectVersionAcl",
          "s3:GetObjectVersionTagging"
        ],
        "Resource": "arn:aws:s3:::kaigo-subsys-prod-backups/*"
      },
      {
        "Sid": "DestinationBucketAccess",
        "Effect": "Allow",
        "Action": [
          "s3:ReplicateObject",
          "s3:ReplicateDelete",
          "s3:ReplicateTags"
        ],
        "Resource": "arn:aws:s3:::kaigo-subsys-dr-backups/*"
      },
      {
        "Sid": "KMSEncryptDecrypt",
        "Effect": "Allow",
        "Action": [
          "kms:Decrypt",
          "kms:Encrypt",
          "kms:GenerateDataKey"
        ],
        "Resource": [
          "arn:aws:kms:us-east-1:123456789012:key/source-backup-key-id",
          "arn:aws:kms:us-west-2:123456789012:key/dr-backup-key-id"
        ]
      }
    ]
  }
}
