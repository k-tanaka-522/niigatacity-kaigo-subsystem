AWSTemplateFormatVersion: '2010-09-09'
Description: 'Subnets Stack for Niigata Kaigo Subsystem - Production Environment'

Metadata:
  AWS::CloudFormation::Interface:
    ParameterGroups:
      - Label:
          default: 'Stack Dependencies'
        Parameters:
          - VPCStackName
      - Label:
          default: 'Environment Configuration'
        Parameters:
          - EnvironmentName
          - ProjectName

Parameters:
  VPCStackName:
    Type: String
    Default: niigata-kaigo-prod-vpc-core-stack
    Description: Name of the VPC Core stack to import values from

  EnvironmentName:
    Type: String
    Default: production
    Description: Environment name

  ProjectName:
    Type: String
    Default: niigata-kaigo
    Description: Project name for tagging

Resources:
  # ========================================
  # Public Subnets
  # ========================================

  PublicSubnet1a:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !ImportValue
        Fn::Sub: '${VPCStackName}-VPCId'
      CidrBlock: 10.1.1.0/24
      AvailabilityZone: !Select [0, !GetAZs '']
      MapPublicIpOnLaunch: false
      Tags:
        - Key: Name
          Value: !Sub '${ProjectName}-${EnvironmentName}-public-subnet-1a'
        - Key: Type
          Value: Public
        - Key: AZ
          Value: ap-northeast-1a
        - Key: Environment
          Value: !Ref EnvironmentName
        - Key: Project
          Value: !Ref ProjectName
        - Key: ManagedBy
          Value: CloudFormation

  PublicSubnet1c:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !ImportValue
        Fn::Sub: '${VPCStackName}-VPCId'
      CidrBlock: 10.1.2.0/24
      AvailabilityZone: !Select [1, !GetAZs '']
      MapPublicIpOnLaunch: false
      Tags:
        - Key: Name
          Value: !Sub '${ProjectName}-${EnvironmentName}-public-subnet-1c'
        - Key: Type
          Value: Public
        - Key: AZ
          Value: ap-northeast-1c
        - Key: Environment
          Value: !Ref EnvironmentName
        - Key: Project
          Value: !Ref ProjectName
        - Key: ManagedBy
          Value: CloudFormation

  # ========================================
  # Private App Subnets
  # ========================================

  PrivateAppSubnet1a:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !ImportValue
        Fn::Sub: '${VPCStackName}-VPCId'
      CidrBlock: 10.1.11.0/24
      AvailabilityZone: !Select [0, !GetAZs '']
      MapPublicIpOnLaunch: false
      Tags:
        - Key: Name
          Value: !Sub '${ProjectName}-${EnvironmentName}-private-app-subnet-1a'
        - Key: Type
          Value: Private
        - Key: Layer
          Value: Application
        - Key: AZ
          Value: ap-northeast-1a
        - Key: Environment
          Value: !Ref EnvironmentName
        - Key: Project
          Value: !Ref ProjectName
        - Key: ManagedBy
          Value: CloudFormation

  PrivateAppSubnet1c:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !ImportValue
        Fn::Sub: '${VPCStackName}-VPCId'
      CidrBlock: 10.1.12.0/24
      AvailabilityZone: !Select [1, !GetAZs '']
      MapPublicIpOnLaunch: false
      Tags:
        - Key: Name
          Value: !Sub '${ProjectName}-${EnvironmentName}-private-app-subnet-1c'
        - Key: Type
          Value: Private
        - Key: Layer
          Value: Application
        - Key: AZ
          Value: ap-northeast-1c
        - Key: Environment
          Value: !Ref EnvironmentName
        - Key: Project
          Value: !Ref ProjectName
        - Key: ManagedBy
          Value: CloudFormation

  # ========================================
  # Private DB Subnets
  # ========================================

  PrivateDBSubnet1a:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !ImportValue
        Fn::Sub: '${VPCStackName}-VPCId'
      CidrBlock: 10.1.21.0/24
      AvailabilityZone: !Select [0, !GetAZs '']
      MapPublicIpOnLaunch: false
      Tags:
        - Key: Name
          Value: !Sub '${ProjectName}-${EnvironmentName}-private-db-subnet-1a'
        - Key: Type
          Value: Private
        - Key: Layer
          Value: Database
        - Key: AZ
          Value: ap-northeast-1a
        - Key: Environment
          Value: !Ref EnvironmentName
        - Key: Project
          Value: !Ref ProjectName
        - Key: ManagedBy
          Value: CloudFormation

  PrivateDBSubnet1c:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !ImportValue
        Fn::Sub: '${VPCStackName}-VPCId'
      CidrBlock: 10.1.22.0/24
      AvailabilityZone: !Select [1, !GetAZs '']
      MapPublicIpOnLaunch: false
      Tags:
        - Key: Name
          Value: !Sub '${ProjectName}-${EnvironmentName}-private-db-subnet-1c'
        - Key: Type
          Value: Private
        - Key: Layer
          Value: Database
        - Key: AZ
          Value: ap-northeast-1c
        - Key: Environment
          Value: !Ref EnvironmentName
        - Key: Project
          Value: !Ref ProjectName
        - Key: ManagedBy
          Value: CloudFormation

  # ========================================
  # Private Cache Subnets
  # ========================================

  PrivateCacheSubnet1a:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !ImportValue
        Fn::Sub: '${VPCStackName}-VPCId'
      CidrBlock: 10.1.31.0/24
      AvailabilityZone: !Select [0, !GetAZs '']
      MapPublicIpOnLaunch: false
      Tags:
        - Key: Name
          Value: !Sub '${ProjectName}-${EnvironmentName}-private-cache-subnet-1a'
        - Key: Type
          Value: Private
        - Key: Layer
          Value: Cache
        - Key: AZ
          Value: ap-northeast-1a
        - Key: Environment
          Value: !Ref EnvironmentName
        - Key: Project
          Value: !Ref ProjectName
        - Key: ManagedBy
          Value: CloudFormation

  PrivateCacheSubnet1c:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !ImportValue
        Fn::Sub: '${VPCStackName}-VPCId'
      CidrBlock: 10.1.32.0/24
      AvailabilityZone: !Select [1, !GetAZs '']
      MapPublicIpOnLaunch: false
      Tags:
        - Key: Name
          Value: !Sub '${ProjectName}-${EnvironmentName}-private-cache-subnet-1c'
        - Key: Type
          Value: Private
        - Key: Layer
          Value: Cache
        - Key: AZ
          Value: ap-northeast-1c
        - Key: Environment
          Value: !Ref EnvironmentName
        - Key: Project
          Value: !Ref ProjectName
        - Key: ManagedBy
          Value: CloudFormation

Outputs:
  # Public Subnets
  PublicSubnet1aId:
    Description: Public Subnet 1a ID
    Value: !Ref PublicSubnet1a
    Export:
      Name: !Sub '${AWS::StackName}-PublicSubnet1aId'

  PublicSubnet1cId:
    Description: Public Subnet 1c ID
    Value: !Ref PublicSubnet1c
    Export:
      Name: !Sub '${AWS::StackName}-PublicSubnet1cId'

  # Private App Subnets
  PrivateAppSubnet1aId:
    Description: Private App Subnet 1a ID
    Value: !Ref PrivateAppSubnet1a
    Export:
      Name: !Sub '${AWS::StackName}-PrivateAppSubnet1aId'

  PrivateAppSubnet1cId:
    Description: Private App Subnet 1c ID
    Value: !Ref PrivateAppSubnet1c
    Export:
      Name: !Sub '${AWS::StackName}-PrivateAppSubnet1cId'

  # Private DB Subnets
  PrivateDBSubnet1aId:
    Description: Private DB Subnet 1a ID
    Value: !Ref PrivateDBSubnet1a
    Export:
      Name: !Sub '${AWS::StackName}-PrivateDBSubnet1aId'

  PrivateDBSubnet1cId:
    Description: Private DB Subnet 1c ID
    Value: !Ref PrivateDBSubnet1c
    Export:
      Name: !Sub '${AWS::StackName}-PrivateDBSubnet1cId'

  # Private Cache Subnets
  PrivateCacheSubnet1aId:
    Description: Private Cache Subnet 1a ID
    Value: !Ref PrivateCacheSubnet1a
    Export:
      Name: !Sub '${AWS::StackName}-PrivateCacheSubnet1aId'

  PrivateCacheSubnet1cId:
    Description: Private Cache Subnet 1c ID
    Value: !Ref PrivateCacheSubnet1c
    Export:
      Name: !Sub '${AWS::StackName}-PrivateCacheSubnet1cId'
