# 2.2.7.2 ERå›³ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆMermaidï¼‰

## ç›®çš„

è¦ä»¶å®šç¾©ãƒ•ã‚§ãƒ¼ã‚ºã§ã€**ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã¨ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£é–“ã®é–¢ä¿‚**ã‚’è¦–è¦šçš„ã«è¡¨ç¾ã™ã‚‹ãŸã‚ã®Mermaid ERå›³ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æä¾›ã—ã¾ã™ã€‚

### ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§å¾—ã‚‰ã‚Œã‚‹ã“ã¨

1. ã™ãã«ä½¿ãˆã‚‹Mermaid ERå›³ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
2. ãƒ‰ãƒ¡ã‚¤ãƒ³ã”ã¨ã®å…·ä½“ä¾‹
3. ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£ï¼ˆ1:1, 1:N, N:Nï¼‰ã®è¡¨ç¾æ–¹æ³•

---

## ğŸ“Š åŸºæœ¬ãƒ‘ã‚¿ãƒ¼ãƒ³

### ã‚·ãƒ³ãƒ—ãƒ«ãªERå›³

```mermaid
erDiagram
    CUSTOMER ||--o{ ORDER : places
    ORDER ||--|{ ORDER_ITEM : contains
    PRODUCT ||--o{ ORDER_ITEM : "ordered in"

    CUSTOMER {
        int id PK
        string name
        string email UK
        datetime created_at
    }

    ORDER {
        int id PK
        int customer_id FK
        datetime order_date
        string status
    }

    ORDER_ITEM {
        int id PK
        int order_id FK
        int product_id FK
        int quantity
        decimal price
    }

    PRODUCT {
        int id PK
        string name
        decimal price
        int stock
    }
```

**è¨˜æ³•**:
- `||--o{` : 1å¯¾å¤šï¼ˆ1ã¤ã®é¡§å®¢ãŒè¤‡æ•°ã®æ³¨æ–‡ï¼‰
- `||--|{` : 1å¯¾å¤šå¿…é ˆ
- `PK` : Primary Key
- `FK` : Foreign Key
- `UK` : Unique Key

---

## ğŸ¯ ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£ã®è¡¨ç¾

### 1å¯¾1 (1:1)

```mermaid
erDiagram
    USER ||--|| PROFILE : has

    USER {
        int id PK
        string email UK
    }

    PROFILE {
        int id PK
        int user_id FK
        string display_name
        text bio
    }
```

**è§£èª¬**: 1äººã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«1ã¤ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«

---

### 1å¯¾å¤š (1:N)

```mermaid
erDiagram
    COMPANY ||--o{ EMPLOYEE : employs

    COMPANY {
        int id PK
        string name
    }

    EMPLOYEE {
        int id PK
        int company_id FK
        string name
        string position
    }
```

**è§£èª¬**: 1ã¤ã®ä¼šç¤¾ãŒè¤‡æ•°ã®å¾“æ¥­å“¡ã‚’é›‡ç”¨

---

### å¤šå¯¾å¤š (N:N)

```mermaid
erDiagram
    STUDENT }o--o{ COURSE : enrolls
    STUDENT ||--o{ ENROLLMENT : ""
    COURSE ||--o{ ENROLLMENT : ""

    STUDENT {
        int id PK
        string name
    }

    COURSE {
        int id PK
        string name
    }

    ENROLLMENT {
        int id PK
        int student_id FK
        int course_id FK
        datetime enrolled_at
        int grade
    }
```

**è§£èª¬**:
- å­¦ç”Ÿã¨æˆæ¥­ã¯å¤šå¯¾å¤š
- ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ« `ENROLLMENT` ã§å®Ÿç¾
- ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¿½åŠ æƒ…å ±ï¼ˆæˆç¸¾ç­‰ï¼‰ã‚‚ä¿å­˜å¯èƒ½

---

## ğŸ¢ ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ¥ãƒ‘ã‚¿ãƒ¼ãƒ³

### 1. ECã‚µã‚¤ãƒˆ

```mermaid
erDiagram
    CUSTOMER ||--o{ ORDER : places
    CUSTOMER ||--o{ CART : has
    ORDER ||--|{ ORDER_ITEM : contains
    PRODUCT ||--o{ ORDER_ITEM : "ordered in"
    PRODUCT ||--o{ CART_ITEM : "in cart"
    CART ||--|{ CART_ITEM : contains
    CATEGORY ||--o{ PRODUCT : categorizes
    PRODUCT ||--o{ REVIEW : receives

    CUSTOMER {
        int id PK
        string name
        string email UK
        string password_hash
        datetime created_at
    }

    ORDER {
        int id PK
        int customer_id FK
        datetime order_date
        string status "pending, paid, shipped, delivered"
        decimal total_amount
    }

    ORDER_ITEM {
        int id PK
        int order_id FK
        int product_id FK
        int quantity
        decimal unit_price
        decimal subtotal
    }

    PRODUCT {
        int id PK
        int category_id FK
        string name
        text description
        decimal price
        int stock
        datetime created_at
    }

    CATEGORY {
        int id PK
        string name
        int parent_id FK "è‡ªå·±å‚ç…§"
    }

    CART {
        int id PK
        int customer_id FK
        datetime created_at
    }

    CART_ITEM {
        int id PK
        int cart_id FK
        int product_id FK
        int quantity
    }

    REVIEW {
        int id PK
        int product_id FK
        int customer_id FK
        int rating "1-5"
        text comment
        datetime created_at
    }
```

**ãƒã‚¤ãƒ³ãƒˆ**:
- ã‚«ãƒ¼ãƒˆæ©Ÿèƒ½ã‚’å«ã‚ã‚‹
- ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½ã‚‚å«ã‚ã‚‹
- ã‚«ãƒ†ã‚´ãƒªã®éšå±¤æ§‹é€ ï¼ˆparent_idï¼‰

---

### 2. äºˆç´„ã‚·ã‚¹ãƒ†ãƒ 

```mermaid
erDiagram
    USER ||--o{ RESERVATION : makes
    FACILITY ||--o{ TIME_SLOT : has
    TIME_SLOT ||--o| RESERVATION : "reserved by"
    FACILITY ||--o{ FACILITY_IMAGE : has
    FACILITY_TYPE ||--o{ FACILITY : categorizes

    USER {
        int id PK
        string name
        string email UK
        string phone
        datetime created_at
    }

    FACILITY {
        int id PK
        int facility_type_id FK
        string name
        text description
        int capacity
        decimal hourly_rate
    }

    FACILITY_TYPE {
        int id PK
        string name "ä¼šè­°å®¤, ã‚¹ã‚¿ã‚¸ã‚ª, etc"
    }

    TIME_SLOT {
        int id PK
        int facility_id FK
        date date
        time start_time
        time end_time
        boolean is_available
    }

    RESERVATION {
        int id PK
        int user_id FK
        int time_slot_id FK
        string status "pending, confirmed, cancelled"
        decimal price
        datetime created_at
    }

    FACILITY_IMAGE {
        int id PK
        int facility_id FK
        string url
        int display_order
    }
```

**ãƒã‚¤ãƒ³ãƒˆ**:
- TIME_SLOTã§æ™‚é–“æ ã‚’ç®¡ç†
- äºˆç´„çŠ¶æ…‹ï¼ˆpending, confirmed, cancelledï¼‰
- æ–½è¨­ç”»åƒã®è¤‡æ•°ä¿å­˜

---

### 3. æ¥­å‹™ã‚·ã‚¹ãƒ†ãƒ ï¼ˆå•†è«‡ç®¡ç†CRMï¼‰

```mermaid
erDiagram
    USER ||--o{ DEAL : owns
    COMPANY ||--o{ DEAL : "has deals"
    COMPANY ||--o{ CONTACT : employs
    CONTACT ||--o{ DEAL : involves
    DEAL ||--o{ ACTIVITY : has
    DEAL ||--o{ NOTE : has
    USER ||--o{ ACTIVITY : performs

    USER {
        int id PK
        string name
        string email UK
        string role "admin, manager, sales"
        int team_id FK
        datetime created_at
    }

    COMPANY {
        int id PK
        string name
        string industry
        int employee_count
        string website
        datetime created_at
    }

    CONTACT {
        int id PK
        int company_id FK
        string name
        string email
        string phone
        string position
    }

    DEAL {
        int id PK
        int owner_id FK "USERã®id"
        int company_id FK
        int contact_id FK
        string title
        decimal amount
        string stage "lead, proposal, negotiation, closed"
        date expected_close_date
        datetime created_at
    }

    ACTIVITY {
        int id PK
        int deal_id FK
        int user_id FK
        string type "call, email, meeting"
        text summary
        datetime activity_date
    }

    NOTE {
        int id PK
        int deal_id FK
        int user_id FK
        text content
        datetime created_at
    }
```

**ãƒã‚¤ãƒ³ãƒˆ**:
- å•†è«‡ã®é€²æ—ç®¡ç†ï¼ˆstageï¼‰
- ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£è¨˜éŒ²ï¼ˆé›»è©±ã€ãƒ¡ãƒ¼ãƒ«ã€ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼‰
- ãƒãƒ¼ãƒˆãƒ»ãƒ¡ãƒ¢æ©Ÿèƒ½

---

### 4. SNSãƒ»ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚µã‚¤ãƒˆ

```mermaid
erDiagram
    USER ||--o{ POST : creates
    USER ||--o{ COMMENT : writes
    USER ||--o{ LIKE : gives
    POST ||--o{ COMMENT : has
    POST ||--o{ LIKE : receives
    USER ||--o{ FOLLOW : follows
    USER ||--o{ FOLLOW : "followed by"

    USER {
        int id PK
        string username UK
        string email UK
        string password_hash
        string avatar_url
        text bio
        datetime created_at
    }

    POST {
        int id PK
        int user_id FK
        text content
        string image_url
        int like_count
        int comment_count
        datetime created_at
    }

    COMMENT {
        int id PK
        int post_id FK
        int user_id FK
        text content
        datetime created_at
    }

    LIKE {
        int id PK
        int post_id FK
        int user_id FK
        datetime created_at
    }

    FOLLOW {
        int id PK
        int follower_id FK "ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹äºº"
        int followee_id FK "ãƒ•ã‚©ãƒ­ãƒ¼ã•ã‚Œã‚‹äºº"
        datetime created_at
    }
```

**ãƒã‚¤ãƒ³ãƒˆ**:
- FOLLOW ã¯è‡ªå·±å‚ç…§ï¼ˆUSER â†’ USERï¼‰
- ã„ã„ã­æ•°ãƒ»ã‚³ãƒ¡ãƒ³ãƒˆæ•°ã¯éæ­£è¦åŒ–ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹é‡è¦–ï¼‰
- è¤‡åˆãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ãŒå¿…è¦ï¼ˆpost_id + user_idï¼‰

---

### 5. é‡‘èç³»ï¼ˆé€é‡‘ã‚·ã‚¹ãƒ†ãƒ ï¼‰

```mermaid
erDiagram
    USER ||--o{ ACCOUNT : owns
    ACCOUNT ||--o{ TRANSACTION : sends
    ACCOUNT ||--o{ TRANSACTION : receives

    USER {
        int id PK
        string name
        string email UK
        string phone
        datetime created_at
    }

    ACCOUNT {
        int id PK
        int user_id FK
        string account_number UK
        decimal balance
        string currency "JPY, USD, etc"
        string status "active, frozen, closed"
        datetime created_at
    }

    TRANSACTION {
        int id PK
        int from_account_id FK
        int to_account_id FK
        decimal amount
        string currency
        string status "pending, completed, failed"
        string type "transfer, deposit, withdrawal"
        datetime created_at
        datetime completed_at
    }
```

**ãƒã‚¤ãƒ³ãƒˆ**:
- é€é‡‘å…ƒãƒ»é€é‡‘å…ˆã®ä¸¡æ–¹ã‚’è¨˜éŒ²
- ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®ç®¡ç†ï¼ˆpending, completed, failedï¼‰
- é€šè²¨ã®æ˜ç¤º

---

## ğŸ”„ è‡ªå·±å‚ç…§ã®ãƒ‘ã‚¿ãƒ¼ãƒ³

### ã‚«ãƒ†ã‚´ãƒªã®éšå±¤æ§‹é€ 

```mermaid
erDiagram
    CATEGORY ||--o{ CATEGORY : "parent of"

    CATEGORY {
        int id PK
        string name
        int parent_id FK "è‡ªå·±å‚ç…§: NULL=ãƒ«ãƒ¼ãƒˆ"
        int display_order
    }
```

**ä¾‹**:
```
å®¶é›»ï¼ˆparent_id=NULLï¼‰
â”œâ”€â”€ ãƒ†ãƒ¬ãƒ“ï¼ˆparent_id=1ï¼‰
â”‚   â”œâ”€â”€ æ¶²æ™¶ãƒ†ãƒ¬ãƒ“ï¼ˆparent_id=2ï¼‰
â”‚   â””â”€â”€ æœ‰æ©ŸELãƒ†ãƒ¬ãƒ“ï¼ˆparent_id=2ï¼‰
â””â”€â”€ å†·è”µåº«ï¼ˆparent_id=1ï¼‰
```

---

### çµ„ç¹”ã®éšå±¤æ§‹é€ 

```mermaid
erDiagram
    DEPARTMENT ||--o{ DEPARTMENT : "parent of"
    DEPARTMENT ||--o{ EMPLOYEE : employs

    DEPARTMENT {
        int id PK
        string name
        int parent_id FK "è‡ªå·±å‚ç…§"
    }

    EMPLOYEE {
        int id PK
        int department_id FK
        string name
    }
```

---

## âŒ Bad Example: ã‚ˆãã‚ã‚‹å¤±æ•—ãƒ‘ã‚¿ãƒ¼ãƒ³

### å•é¡Œ1: å¤šå¯¾å¤šã‚’ç›´æ¥çµã¶

```mermaid
erDiagram
    STUDENT }o--o{ COURSE : enrolls

    STUDENT {
        int id PK
        string name
    }

    COURSE {
        int id PK
        string name
    }
```

**å•é¡Œç‚¹**:
- ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«ãŒãªã„
- æˆç¸¾ç­‰ã®è¿½åŠ æƒ…å ±ã‚’ä¿å­˜ã§ããªã„
- å®Ÿè£…ãŒå›°é›£

---

### âœ… Good Example: ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œã‚‹

```mermaid
erDiagram
    STUDENT ||--o{ ENROLLMENT : ""
    COURSE ||--o{ ENROLLMENT : ""

    STUDENT {
        int id PK
        string name
    }

    COURSE {
        int id PK
        string name
    }

    ENROLLMENT {
        int id PK
        int student_id FK
        int course_id FK
        int grade
        datetime enrolled_at
    }
```

**æ”¹å–„ç‚¹**:
- ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ« `ENROLLMENT` ã§å¤šå¯¾å¤šã‚’å®Ÿç¾
- æˆç¸¾ç­‰ã®è¿½åŠ æƒ…å ±ã‚’ä¿å­˜å¯èƒ½

---

### å•é¡Œ2: ãƒ‡ãƒ¼ã‚¿å‹ãƒ»åˆ¶ç´„ãŒä¸æ˜

```mermaid
erDiagram
    USER {
        id
        name
        email
    }
```

**å•é¡Œç‚¹**:
- ãƒ‡ãƒ¼ã‚¿å‹ãŒãªã„
- PK/FK/UKã®æŒ‡å®šãŒãªã„
- å®Ÿè£…æ™‚ã«æ··ä¹±

---

### âœ… Good Example: ãƒ‡ãƒ¼ã‚¿å‹ãƒ»åˆ¶ç´„ã‚’æ˜è¨˜

```mermaid
erDiagram
    USER {
        int id PK
        string name
        string email UK
        datetime created_at
    }
```

**æ”¹å–„ç‚¹**:
- ãƒ‡ãƒ¼ã‚¿å‹ã‚’æ˜è¨˜
- PK/UK/FKã‚’æ˜è¨˜
- å®Ÿè£…è€…ãŒè¿·ã‚ãªã„

---

## ğŸ“ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

### åŸºæœ¬ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

```markdown
## ERå›³

```mermaid
erDiagram
    ENTITY1 ||--o{ ENTITY2 : relationship

    ENTITY1 {
        int id PK
        string name
        datetime created_at
    }

    ENTITY2 {
        int id PK
        int entity1_id FK
        string name
        datetime created_at
    }
```

**èª¬æ˜**:
- ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£é–“ã®é–¢ä¿‚ã‚’è¨˜è¿°
- ãƒ‡ãƒ¼ã‚¿å‹ãƒ»åˆ¶ç´„ã‚’æ˜è¨˜
```

---

## ğŸ”§ å®Ÿè£…æ™‚ã®æ³¨æ„ç‚¹

### 1. è«–ç†è¨­è¨ˆã¨ç‰©ç†è¨­è¨ˆ

**è¦ä»¶å®šç¾©ï¼ˆè«–ç†è¨­è¨ˆï¼‰**:
- ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£åã¯æ¥­å‹™ç”¨èªï¼ˆæ—¥æœ¬èªã§ã‚‚OKï¼‰
- æ­£è¦åŒ–ã‚’é‡è¦–
- æ¦‚å¿µçš„ãªERå›³

**è©³ç´°è¨­è¨ˆï¼ˆç‰©ç†è¨­è¨ˆï¼‰**:
- ãƒ†ãƒ¼ãƒ–ãƒ«åã¯è‹±èªï¼ˆå°æ–‡å­—ï¼‹ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ï¼‰
- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ»ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚‚è€ƒæ…®
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®ãŸã‚ã®éæ­£è¦åŒ–ã‚‚æ¤œè¨

### 2. Mermaid ERå›³ã®åˆ¶é™

Mermaidã§ã¯ä»¥ä¸‹ãŒè¡¨ç¾ã§ããªã„:
- **è¤‡åˆä¸»ã‚­ãƒ¼**: ã‚³ãƒ¡ãƒ³ãƒˆã§è£œè¶³
- **ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**: åˆ¥é€”ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–
- **CHECKåˆ¶ç´„**: å±æ€§ã®èª¬æ˜æ¬„ã«è¨˜è¼‰

### 3. æ¨å¥¨ãƒ‡ãƒ¼ã‚¿å‹

| ç”¨é€” | ãƒ‡ãƒ¼ã‚¿å‹ |
|------|---------|
| ID | `int` ã¾ãŸã¯ `bigint` |
| åå‰ãƒ»ã‚¿ã‚¤ãƒˆãƒ« | `string (varchar)` |
| é•·æ–‡ | `text` |
| æ—¥æ™‚ | `datetime` ã¾ãŸã¯ `timestamp` |
| æ—¥ä»˜ã®ã¿ | `date` |
| é‡‘é¡ | `decimal` |
| ãƒ•ãƒ©ã‚° | `boolean` |

---

## ğŸ“š æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ERå›³ã‚’ç†è§£ã—ãŸã‚‰:

1. **2.2.7.3 ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³ï¼ˆæ¦‚å¿µãƒ¬ãƒ™ãƒ«ï¼‰.md** ã¸é€²ã‚€
2. ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å¯è¦–åŒ–ã‚’å­¦ã¶
3. å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ERå›³ã‚’ä½œæˆ

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [2.2.2.3 ãƒ‡ãƒ¼ã‚¿è¦ä»¶ãƒ’ã‚¢ãƒªãƒ³ã‚°é …ç›®](./2.2.2.3_ãƒ‡ãƒ¼ã‚¿è¦ä»¶ãƒ’ã‚¢ãƒªãƒ³ã‚°é …ç›®.md)
- [2.2.7.1 ç”»é¢é·ç§»å›³ãƒ‘ã‚¿ãƒ¼ãƒ³](./2.2.7.1_ç”»é¢é·ç§»å›³ãƒ‘ã‚¿ãƒ¼ãƒ³.md)
- [2.2.7.6 Good_Bad_Exampleé›†](./2.2.7.6_Good_Bad_Exampleé›†.md)

---

**ä½œæˆæ—¥**: 2025-10-19
**å¯¾è±¡ãƒ•ã‚§ãƒ¼ã‚º**: è¦ä»¶å®šç¾©
**é‡è¦åº¦**: â­â­â­ å¿…é ˆï¼ˆãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®å¯è¦–åŒ–ï¼‰
