# 2.5.4.1 çµåˆãƒ†ã‚¹ãƒˆæ–¹é‡

## ç›®çš„

è¤‡æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã®é€£æºã‚’æ¤œè¨¼ã™ã‚‹çµåˆãƒ†ã‚¹ãƒˆã®æ–¹é‡ã‚’å®šç¾©ã—ã¾ã™ã€‚

---

## ğŸ”— çµåˆãƒ†ã‚¹ãƒˆã®ç¯„å›²

### å¯¾è±¡ã¨ã™ã‚‹é€£æº

1. **API â‡” ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯**
   - APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‹ã‚‰ã‚µãƒ¼ãƒ“ã‚¹å±¤ã¾ã§ã®é€šä¿¡
   - ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å¤‰æ›
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

2. **ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ â‡” ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**
   - ãƒªãƒã‚¸ãƒˆãƒªå±¤ã®DBæ“ä½œ
   - ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†
   - ãƒ‡ãƒ¼ã‚¿ã®æ°¸ç¶šåŒ–ã¨å–å¾—

3. **å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ é€£æº**
   - å¤–éƒ¨APIå‘¼ã³å‡ºã—
   - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚­ãƒ¥ãƒ¼
   - S3ã€SNSã€SQSç­‰ã®AWSã‚µãƒ¼ãƒ“ã‚¹

---

## ğŸ“‹ ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### 1. ãƒ†ã‚¹ãƒˆç’°å¢ƒ

```yaml
# docker-compose.test.yml
version: '3.8'
services:
  postgres:
    image: postgres:15
    environment:
      POSTGRES_DB: testdb
      POSTGRES_USER: testuser
      POSTGRES_PASSWORD: testpass
    ports:
      - "5433:5432"

  redis:
    image: redis:7
    ports:
      - "6380:6379"

  localstack:  # AWSã‚µãƒ¼ãƒ“ã‚¹ãƒ¢ãƒƒã‚¯
    image: localstack/localstack
    environment:
      SERVICES: s3,sqs,sns
    ports:
      - "4566:4566"
```

### 2. ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç®¡ç†

- **Fixtureãƒ™ãƒ¼ã‚¹ã®DBã‚·ãƒ¼ãƒ‰**
- **ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯**ï¼ˆãƒ†ã‚¹ãƒˆé–“ã®ç‹¬ç«‹æ€§ï¼‰
- **ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ãƒ“ãƒ«ãƒ€ãƒ¼**ãƒ‘ã‚¿ãƒ¼ãƒ³

### 3. ãƒ¢ãƒƒã‚¯ã®ä½¿ã„åˆ†ã‘

| å¯¾è±¡ | æ–¹é‡ | ç†ç”± |
|------|------|------|
| DB | **å®ŸDBä½¿ç”¨**ï¼ˆãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒ†ãƒŠï¼‰ | å®Ÿéš›ã®SQLå®Ÿè¡Œã‚’æ¤œè¨¼ |
| å¤–éƒ¨API | **ãƒ¢ãƒƒã‚¯ä½¿ç”¨** | å¤–éƒ¨ä¾å­˜ã‚’æ’é™¤ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’åˆ¶å¾¡ |
| AWSã‚µãƒ¼ãƒ“ã‚¹ | **LocalStackä½¿ç”¨** | å®Ÿç’°å¢ƒã«è¿‘ã„å½¢ã§æ¤œè¨¼ |

---

## âœ… å®Ÿæ–½é …ç›®

### APIçµåˆãƒ†ã‚¹ãƒˆ

```python
# FastAPI example
@pytest.mark.integration
async def test_create_user_endpoint():
    # Arrange
    async with AsyncClient(app=app, base_url="http://test") as client:
        payload = {"name": "Test User", "email": "test@example.com"}

        # Act
        response = await client.post("/users", json=payload)

        # Assert
        assert response.status_code == 201
        data = response.json()
        assert data["name"] == "Test User"

        # DBç¢ºèª
        user = await db.query(User).filter_by(email="test@example.com").first()
        assert user is not None
```

### DBçµåˆãƒ†ã‚¹ãƒˆ

```typescript
// TypeScript example
describe('UserRepository Integration Tests', () => {
  let connection: DataSource;

  beforeAll(async () => {
    connection = await createTestConnection();
  });

  afterAll(async () => {
    await connection.destroy();
  });

  it('should save and retrieve user from database', async () => {
    // Arrange
    const repo = connection.getRepository(User);
    const user = new User({ name: 'Test', email: 'test@example.com' });

    // Act
    await repo.save(user);
    const found = await repo.findOne({ where: { email: 'test@example.com' } });

    // Assert
    expect(found).toBeDefined();
    expect(found!.name).toBe('Test');
  });
});
```

---

## ğŸ¯ ç›®æ¨™å“è³ªåŸºæº–

- âœ… ä¸»è¦ãªAPI-DBé€£æºãƒ‘ã‚¹ã‚’ç¶²ç¾…
- âœ… ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ï¼ˆDBæ¥ç¶šå¤±æ•—ã€ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¤±æ•—ï¼‰ã‚’æ¤œè¨¼
- âœ… çµåˆãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸: ä¸»è¦ãƒ•ãƒ­ãƒ¼80%ä»¥ä¸Š

---

**ä½œæˆæ—¥**: 2025-10-19
**é‡è¦åº¦**: â­â­â­
