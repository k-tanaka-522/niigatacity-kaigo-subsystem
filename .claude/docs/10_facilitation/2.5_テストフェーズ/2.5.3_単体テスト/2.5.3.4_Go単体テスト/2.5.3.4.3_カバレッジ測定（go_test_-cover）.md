# 2.5.3.4.3 ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®šï¼ˆgo test -coverï¼‰

## ç›®çš„

ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’æ¸¬å®šã—ã€80%ä»¥ä¸Šã‚’é”æˆã—ã¾ã™ã€‚

---

## ðŸ“Š ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®š

### åŸºæœ¬çš„ãªã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®š

```bash
# ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ãã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
go test -cover ./...

# å‡ºåŠ›ä¾‹
ok      myapp/service   0.123s  coverage: 85.7% of statements
```

### ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ

```bash
# ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ
go test -coverprofile=coverage.out ./...

# ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’HTMLå½¢å¼ã§è¡¨ç¤º
go tool cover -html=coverage.out -o coverage.html

# ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã
open coverage.html  # macOS
start coverage.html # Windows
```

### è©³ç´°ãªã‚«ãƒãƒ¬ãƒƒã‚¸æƒ…å ±

```bash
# é–¢æ•°ã”ã¨ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’è¡¨ç¤º
go tool cover -func=coverage.out

# å‡ºåŠ›ä¾‹
myapp/service/user.go:15:  GetUser         85.7%
myapp/service/user.go:30:  CreateUser      90.0%
myapp/service/user.go:45:  UpdateUser      75.0%
total:                     (statements)    85.7%
```

### ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã”ã¨ã®ã‚«ãƒãƒ¬ãƒƒã‚¸

```bash
# ã™ã¹ã¦ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚«ãƒãƒ¬ãƒƒã‚¸
go test -cover ./...

# ç‰¹å®šã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã¿
go test -cover ./service/...
```

### ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¢ãƒ¼ãƒ‰

```bash
# set: è¡ŒãŒã‚«ãƒãƒ¼ã•ã‚ŒãŸã‹ã©ã†ã‹ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
go test -covermode=set -coverprofile=coverage.out ./...

# count: è¡ŒãŒä½•å›žå®Ÿè¡Œã•ã‚ŒãŸã‹
go test -covermode=count -coverprofile=coverage.out ./...

# atomic: ä¸¦è¡Œå‡¦ç†ã«å¯¾å¿œã—ãŸcount
go test -covermode=atomic -coverprofile=coverage.out ./...
```

### Makefileã§ã®è‡ªå‹•åŒ–

```makefile
.PHONY: test coverage

test:
	go test -v ./...

coverage:
	go test -coverprofile=coverage.out ./...
	go tool cover -html=coverage.out -o coverage.html
	@echo "Coverage report generated: coverage.html"

coverage-check:
	@go test -coverprofile=coverage.out ./... > /dev/null
	@go tool cover -func=coverage.out | grep total | \
	awk '{print $$3}' | sed 's/%//' | \
	awk '{if ($$1 < 80) {print "Coverage " $$1 "% is below 80%"; exit 1} else {print "Coverage " $$1 "% OK"}}'
```

### CIã§ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒã‚§ãƒƒã‚¯

```yaml
# GitHub Actions
name: Test
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-go@v4
        with:
          go-version: '1.21'

      - name: Run tests with coverage
        run: go test -coverprofile=coverage.out ./...

      - name: Check coverage threshold
        run: |
          coverage=$(go tool cover -func=coverage.out | grep total | awk '{print $3}' | sed 's/%//')
          if (( $(echo "$coverage < 80" | bc -l) )); then
            echo "Coverage $coverage% is below 80%"
            exit 1
          fi
          echo "Coverage $coverage% OK"
```

### ç›®æ¨™

- âœ… **ã‚«ãƒãƒ¬ãƒƒã‚¸80%ä»¥ä¸Š**
- âœ… é‡è¦ãªæ¥­å‹™ãƒ­ã‚¸ãƒƒã‚¯: 90%ä»¥ä¸Š
- âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°åˆ†å²ã‚‚ç¶²ç¾…

### ã‚«ãƒãƒ¬ãƒƒã‚¸é™¤å¤–

```go
// ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚„mainãƒ•ã‚¡ã‚¤ãƒ«ã‚’é™¤å¤–
go test -coverprofile=coverage.out -coverpkg=./... $(go list ./... | grep -v /mocks | grep -v /cmd)
```

---

**ä½œæˆæ—¥**: 2025-10-19
**é‡è¦åº¦**: â­â­â­
