# 2.5.3.2.2 ãƒ¢ãƒƒã‚­ãƒ³ã‚°ï¼ˆJest mockï¼‰

## ç›®çš„

å¤–éƒ¨ä¾å­˜ã‚’ãƒ¢ãƒƒã‚¯ã—ã¦ã€ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’é«˜é€ŸåŒ–ãƒ»ç‹¬ç«‹åŒ–ã—ã¾ã™ã€‚

---

## ğŸ”„ ãƒ¢ãƒƒã‚­ãƒ³ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³

### jest.fn() - é–¢æ•°ãƒ¢ãƒƒã‚¯

```typescript
import { jest } from '@jest/globals';

describe('UserService', () => {
  it('should call repository with correct arguments', async () => {
    // Arrange
    const mockFind = jest.fn().mockResolvedValue({ id: 1, name: 'Test' });
    const mockRepo = { findById: mockFind };
    const service = new UserService(mockRepo);

    // Act
    const result = await service.getUser(1);

    // Assert
    expect(mockFind).toHaveBeenCalledWith(1);
    expect(mockFind).toHaveBeenCalledTimes(1);
    expect(result.name).toBe('Test');
  });
});
```

### jest.mock() - ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ¢ãƒƒã‚¯

```typescript
// ãƒ•ã‚¡ã‚¤ãƒ«å…¨ä½“ã‚’ãƒ¢ãƒƒã‚¯
jest.mock('../repositories/userRepository');

import { UserRepository } from '../repositories/userRepository';
import { UserService } from './userService';

describe('UserService', () => {
  it('should get user from repository', async () => {
    // Arrange
    const mockUser = { id: 1, name: 'Test' };
    (UserRepository.prototype.findById as jest.Mock).mockResolvedValue(mockUser);

    const service = new UserService(new UserRepository());

    // Act
    const result = await service.getUser(1);

    // Assert
    expect(result).toEqual(mockUser);
  });
});
```

### jest.spyOn() - ã‚¹ãƒ‘ã‚¤

```typescript
describe('UserService', () => {
  it('should log when user not found', async () => {
    // Arrange
    const consoleErrorSpy = jest.spyOn(console, 'error').mockImplementation();
    const mockRepo = { findById: jest.fn().mockResolvedValue(null) };
    const service = new UserService(mockRepo);

    // Act
    await service.getUser(999);

    // Assert
    expect(consoleErrorSpy).toHaveBeenCalledWith('User not found: 999');

    // Cleanup
    consoleErrorSpy.mockRestore();
  });
});
```

### ãƒ¢ãƒƒã‚¯ã®ãƒªã‚»ãƒƒãƒˆ

```typescript
describe('UserService', () => {
  let mockRepo: jest.Mocked<UserRepository>;

  beforeEach(() => {
    mockRepo = {
      findById: jest.fn(),
      save: jest.fn(),
    } as any;
  });

  afterEach(() => {
    jest.clearAllMocks(); // ãƒ¢ãƒƒã‚¯ã®å‘¼ã³å‡ºã—å±¥æ­´ã‚’ã‚¯ãƒªã‚¢
  });

  it('test 1', async () => { /* ... */ });
  it('test 2', async () => { /* ... */ });
});
```

---

**ä½œæˆæ—¥**: 2025-10-19
**é‡è¦åº¦**: â­â­â­
