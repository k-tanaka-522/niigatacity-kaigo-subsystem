# 2.5.8.1 è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³

## ç›®çš„

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è„†å¼±æ€§ã‚’è‡ªå‹•æ¤œå‡ºã—ã€ä¿®æ­£ã—ã¾ã™ã€‚

---

## ğŸ” OWASP Top 10 å¯¾ç­–

### 1. SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³

#### âŒ è„†å¼±ãªã‚³ãƒ¼ãƒ‰ï¼ˆPythonï¼‰

```python
# âŒ Bad: SQLæ–‡å­—åˆ—çµåˆ
def get_user(user_id):
    query = f"SELECT * FROM users WHERE id = {user_id}"  # âŒ SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³è„†å¼±æ€§
    cursor.execute(query)
```

#### âœ… å®‰å…¨ãªã‚³ãƒ¼ãƒ‰

```python
# âœ… Good: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã‚¯ã‚¨ãƒª
def get_user(user_id):
    query = "SELECT * FROM users WHERE id = %s"
    cursor.execute(query, (user_id,))  # ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ä½¿ç”¨
```

---

### 2. XSS (ã‚¯ãƒ­ã‚¹ã‚µã‚¤ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒ†ã‚£ãƒ³ã‚°)

#### âŒ è„†å¼±ãªã‚³ãƒ¼ãƒ‰ï¼ˆJavaScriptï¼‰

```javascript
// âŒ Bad: ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ãªã—
const userInput = req.query.name;
res.send(`<h1>Welcome ${userInput}</h1>`);  // âŒ XSSè„†å¼±æ€§
```

#### âœ… å®‰å…¨ãªã‚³ãƒ¼ãƒ‰

```javascript
// âœ… Good: ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†
const escapeHtml = (str) =>
  str.replace(/[&<>"']/g, (match) => ({
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#39;'
  }[match]));

const userInput = escapeHtml(req.query.name);
res.send(`<h1>Welcome ${userInput}</h1>`);
```

---

### 3. èªè¨¼ã®ä¸å‚™

#### âŒ è„†å¼±ãªã‚³ãƒ¼ãƒ‰

```python
# âŒ Bad: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¹³æ–‡ã§ä¿å­˜
def create_user(username, password):
    db.execute("INSERT INTO users (username, password) VALUES (%s, %s)",
               (username, password))  # âŒ å¹³æ–‡ä¿å­˜
```

#### âœ… å®‰å…¨ãªã‚³ãƒ¼ãƒ‰

```python
# âœ… Good: bcryptã§ãƒãƒƒã‚·ãƒ¥åŒ–
import bcrypt

def create_user(username, password):
    hashed = bcrypt.hashpw(password.encode('utf-8'), bcrypt.gensalt())
    db.execute("INSERT INTO users (username, password_hash) VALUES (%s, %s)",
               (username, hashed))

def verify_password(username, password):
    user = db.fetchone("SELECT password_hash FROM users WHERE username = %s", (username,))
    return bcrypt.checkpw(password.encode('utf-8'), user['password_hash'])
```

---

### 4. ã‚»ãƒ³ã‚·ãƒ†ã‚£ãƒ–ãƒ‡ãƒ¼ã‚¿ã®éœ²å‡º

#### âŒ è„†å¼±ãªã‚³ãƒ¼ãƒ‰

```javascript
// âŒ Bad: ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆæƒ…å ±ã‚’ãƒ­ã‚°å‡ºåŠ›
console.log(`API Key: ${process.env.API_KEY}`);  // âŒ ãƒ­ã‚°ã«éœ²å‡º
```

#### âœ… å®‰å…¨ãªã‚³ãƒ¼ãƒ‰

```javascript
// âœ… Good: ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆæƒ…å ±ã‚’ãƒ­ã‚°å‡ºåŠ›ã—ãªã„
const apiKey = process.env.API_KEY;
// ãƒ­ã‚°ã«ã¯ãƒã‚¹ã‚¯ã—ãŸæƒ…å ±ã®ã¿
console.log(`API Key: ${apiKey.substring(0, 4)}****`);
```

---

## ğŸ› ï¸ è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³ãƒ„ãƒ¼ãƒ«

### OWASP ZAP

```bash
# OWASP ZAPã‚’Dockerã§å®Ÿè¡Œ
docker run -t owasp/zap2docker-stable zap-baseline.py \
  -t https://your-app.example.com

# ãƒ•ãƒ«ã‚¹ã‚­ãƒ£ãƒ³
docker run -t owasp/zap2docker-stable zap-full-scan.py \
  -t https://your-app.example.com \
  -r zap-report.html
```

**æ¤œå‡ºé …ç›®**:
- SQL Injection
- XSS (Cross-Site Scripting)
- CSRF (Cross-Site Request Forgery)
- Security Headers (X-Frame-Options, CSPç­‰)

---

### Snykï¼ˆä¾å­˜é–¢ä¿‚ã‚¹ã‚­ãƒ£ãƒ³ï¼‰

```bash
# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install -g snyk

# èªè¨¼
snyk auth

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¹ã‚­ãƒ£ãƒ³
snyk test

# å‡ºåŠ›ä¾‹:
# âœ— High severity vulnerability found in lodash
#   Vulnerable versions: < 4.17.21
#   Fixed in: 4.17.21
```

**ä¿®æ­£**:

```bash
# è‡ªå‹•ä¿®æ­£
snyk fix

# ã¾ãŸã¯æ‰‹å‹•ã§
npm install lodash@4.17.21
```

---

### Trivyï¼ˆã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¹ã‚­ãƒ£ãƒ³ï¼‰

```bash
# Trivyã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
brew install aquasecurity/trivy/trivy

# ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¹ã‚­ãƒ£ãƒ³
trivy image myapp:latest

# å‡ºåŠ›ä¾‹:
myapp:latest (debian 11.5)
Total: 150 (CRITICAL: 5, HIGH: 20, MEDIUM: 75, LOW: 50)

CRITICAL: CVE-2023-1234 (openssl 1.1.1)
HIGH: CVE-2023-5678 (curl 7.74)
```

**ä¿®æ­£**:

```dockerfile
# Dockerfile
FROM debian:11-slim  # âŒ è„†å¼±æ€§å¤šæ•°

# âœ… æœ€æ–°ã®ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸
FROM debian:12-slim

# ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ›´æ–°
RUN apt-get update && apt-get upgrade -y && apt-get clean
```

---

## ğŸ“‹ CI/CDã§ã®è‡ªå‹•ã‚¹ã‚­ãƒ£ãƒ³

### GitHub Actions

```yaml
name: Security Scan
on: [push, pull_request]

jobs:
  security-scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      # Snykä¾å­˜é–¢ä¿‚ã‚¹ã‚­ãƒ£ãƒ³
      - name: Run Snyk
        uses: snyk/actions/node@master
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
        with:
          args: --severity-threshold=high

      # Trivyã‚³ãƒ³ãƒ†ãƒŠã‚¹ã‚­ãƒ£ãƒ³
      - name: Run Trivy
        uses: aquasecurity/trivy-action@master
        with:
          image-ref: 'myapp:latest'
          format: 'sarif'
          output: 'trivy-results.sarif'

      # OWASP ZAP
      - name: ZAP Scan
        uses: zaproxy/action-baseline@v0.7.0
        with:
          target: 'https://staging.example.com'
```

---

## ğŸ¯ è„†å¼±æ€§å¯¾å¿œã®å„ªå…ˆåº¦

| é‡è¦åº¦ | å¯¾å¿œæœŸé™ | ä¾‹ |
|--------|---------|-----|
| **Critical** | å³åº§ï¼ˆ24æ™‚é–“ä»¥å†…ï¼‰ | SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã€RCE |
| **High** | 1é€±é–“ä»¥å†… | XSSã€èªè¨¼ã®ä¸å‚™ |
| **Medium** | 2é€±é–“ä»¥å†… | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ä¸è¶³ |
| **Low** | æ¬¡å›ãƒªãƒªãƒ¼ã‚¹æ™‚ | å¤ã„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆè„†å¼±æ€§ãªã—ï¼‰ |

---

## âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- âœ… ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ãƒãƒƒã‚·ãƒ¥åŒ–ï¼ˆbcryptã€Argon2ï¼‰
- âœ… SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–ï¼ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã‚¯ã‚¨ãƒªï¼‰
- âœ… XSSå¯¾ç­–ï¼ˆã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†ï¼‰
- âœ… CSRFå¯¾ç­–ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ï¼‰
- âœ… HTTPSå¼·åˆ¶ï¼ˆHTTPâ†’HTTPSãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆï¼‰
- âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼è¨­å®š
  - `X-Frame-Options: DENY`
  - `X-Content-Type-Options: nosniff`
  - `Content-Security-Policy`
  - `Strict-Transport-Security`
- âœ… ä¾å­˜é–¢ä¿‚ã®è„†å¼±æ€§ãƒã‚§ãƒƒã‚¯ï¼ˆSnykã€npm auditï¼‰
- âœ… ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆæƒ…å ±ã®ç’°å¢ƒå¤‰æ•°åŒ–
- âœ… ãƒ­ã‚°ã‹ã‚‰ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆæƒ…å ±é™¤å¤–

---

**ä½œæˆæ—¥**: 2025-10-19
**é‡è¦åº¦**: â­â­â­
