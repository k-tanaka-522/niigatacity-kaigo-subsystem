# 2.4.5.1.6 Python Good_Bad_Exampleé›†

## ç›®çš„

Pythonå®Ÿè£…ã®ã‚ˆãã‚ã‚‹é–“é•ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨æ¨å¥¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç¤ºã—ã¾ã™ã€‚

---

## ğŸ”„ å®Ÿä¾‹ãƒ‘ã‚¿ãƒ¼ãƒ³é›†

### 1. å‹ãƒ’ãƒ³ãƒˆ

#### âŒ Bad Example

```python
# âŒ å‹ãƒ’ãƒ³ãƒˆãªã—
def get_user(user_id):
    return db.query(user_id)

# âŒ æˆ»ã‚Šå€¤ã®å‹ãŒä¸æ˜
def process_data(data):
    result = do_something(data)
    return result
```

**å•é¡Œç‚¹**:
- ã‚¨ãƒ‡ã‚£ã‚¿ã®è£œå®ŒãŒåŠ¹ã‹ãªã„
- å‹ãƒã‚§ãƒƒã‚¯ãŒã§ããªã„
- å¯èª­æ€§ãŒä½ã„

#### âœ… Good Example

```python
from typing import Optional
from src.models.user import User

# âœ… å‹ãƒ’ãƒ³ãƒˆå®Œå‚™
def get_user(user_id: int) -> Optional[User]:
    """ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å–å¾—"""
    return db.query(User).filter(User.id == user_id).first()

# âœ… æˆ»ã‚Šå€¤ã®å‹ãŒæ˜ç¢º
def process_data(data: list[dict]) -> dict[str, int]:
    """ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†ã—ã¦é›†è¨ˆçµæœã‚’è¿”ã™"""
    result = {key: count_values(data, key) for key in data[0].keys()}
    return result
```

**æ”¹å–„ç‚¹**:
- âœ… å‹ãƒ’ãƒ³ãƒˆã«ã‚ˆã‚Šå¯èª­æ€§å‘ä¸Š
- âœ… ã‚¨ãƒ‡ã‚£ã‚¿ã®è£œå®ŒãŒåŠ¹ã
- âœ… mypyã§å‹ãƒã‚§ãƒƒã‚¯å¯èƒ½

---

### 2. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

#### âŒ Bad Example

```python
# âŒ æ±ç”¨çš„ãªExceptionã‚’ã‚­ãƒ£ãƒƒãƒ
try:
    user = db.query(User).first()
except Exception:
    pass  # âŒ ä½•ã‚‚ã—ãªã„

# âŒ ãƒ­ã‚°ãªã—
def get_user(user_id):
    try:
        return db.query(User).get(user_id)
    except:  # âŒ bare except
        return None

# âŒ ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒä¸æ˜ç­
if user is None:
    raise Exception("Error")  # âŒ ä½•ã®ã‚¨ãƒ©ãƒ¼ã‹ä¸æ˜
```

**å•é¡Œç‚¹**:
- ã‚¨ãƒ©ãƒ¼ãŒæ¡ã‚Šã¤ã¶ã•ã‚Œã‚‹
- ãƒ‡ãƒãƒƒã‚°ãŒå›°é›£
- ã‚¨ãƒ©ãƒ¼ã®åŸå› ãŒä¸æ˜

#### âœ… Good Example

```python
from src.utils.exceptions import UserNotFoundError, DatabaseError
import logging

logger = logging.getLogger(__name__)

# âœ… ã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–ã‚’ä½¿ç”¨
async def get_user(user_id: int) -> User:
    """
    ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å–å¾—ã€‚

    Raises:
        UserNotFoundError: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ
        DatabaseError: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ã®å ´åˆ
    """
    try:
        user = await db.query(User).filter(User.id == user_id).first()
        if user is None:
            logger.warning(f"User {user_id} not found")
            raise UserNotFoundError(f"User {user_id} not found")
        return user
    except SQLAlchemyError as e:
        logger.error(f"Database error: {e}")
        raise DatabaseError(f"Failed to get user {user_id}") from e
```

**æ”¹å–„ç‚¹**:
- âœ… ã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–ã§æ„å›³ãŒæ˜ç¢º
- âœ… ãƒ­ã‚°å‡ºåŠ›
- âœ… å…·ä½“çš„ãªä¾‹å¤–ã‚’ã‚­ãƒ£ãƒƒãƒ

---

### 3. docstring

#### âŒ Bad Example

```python
# âŒ docstringãªã—
def get_user(user_id):
    return db.query(User).get(user_id)

# âŒ ä¸ååˆ†ãªdocstring
def process_data(data):
    """ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†"""
    # ä½•ã‚’ã©ã†å‡¦ç†ã™ã‚‹ã®ã‹ä¸æ˜
    pass
```

**å•é¡Œç‚¹**:
- é–¢æ•°ã®ç›®çš„ãŒä¸æ˜
- å¼•æ•°ãƒ»æˆ»ã‚Šå€¤ã®èª¬æ˜ãŒãªã„
- ã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒä¸æ˜

#### âœ… Good Example

```python
from typing import Optional
from src.models.user import User

def get_user(user_id: int) -> Optional[User]:
    """
    ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ã™ã‚‹ã€‚

    Args:
        user_id (int): ãƒ¦ãƒ¼ã‚¶ãƒ¼ID

    Returns:
        Optional[User]: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã€‚å­˜åœ¨ã—ãªã„å ´åˆã¯None

    Raises:
        DatabaseError: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ã®å ´åˆ

    Example:
        >>> user = get_user(1)
        >>> print(user.name)
        "John Doe"
    """
    return db.query(User).filter(User.id == user_id).first()
```

**æ”¹å–„ç‚¹**:
- âœ… Google Style docstring
- âœ… Args, Returns, RaisesãŒæ˜ç¢º
- âœ… ä½¿ç”¨ä¾‹ã‚’è¨˜è¼‰

---

### 4. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

#### âŒ Bad Example

```
myproject/
â”œâ”€â”€ api.py            # âŒ ã™ã¹ã¦1ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ models.py
â””â”€â”€ test.py
```

**å•é¡Œç‚¹**:
- ãƒ•ã‚¡ã‚¤ãƒ«ãŒè‚¥å¤§åŒ–
- å±¤åˆ¥è¨­è¨ˆãŒãªã„
- ä¿å®ˆæ€§ãŒä½ã„

#### âœ… Good Example

```
myproject/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/          # âœ… APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆåˆ†é›¢
â”‚   â”‚   â””â”€â”€ routes.py
â”‚   â”œâ”€â”€ models/       # âœ… ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«åˆ†é›¢
â”‚   â”‚   â””â”€â”€ user.py
â”‚   â”œâ”€â”€ services/     # âœ… ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯åˆ†é›¢
â”‚   â”‚   â””â”€â”€ user_service.py
â”‚   â””â”€â”€ repositories/ # âœ… ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤åˆ†é›¢
â”‚       â””â”€â”€ user_repository.py
â””â”€â”€ tests/
    â”œâ”€â”€ test_api/
    â””â”€â”€ test_services/
```

**æ”¹å–„ç‚¹**:
- âœ… å±¤åˆ¥è¨­è¨ˆ
- âœ… è²¬å‹™ãŒæ˜ç¢º
- âœ… ãƒ†ã‚¹ãƒˆãŒå®¹æ˜“

---

### 5. éåŒæœŸå‡¦ç†

#### âŒ Bad Example

```python
# âŒ åŒæœŸå‡¦ç†ã‚’éåŒæœŸé–¢æ•°ã§å‘¼ã³å‡ºã—
async def get_user(user_id):
    user = db.query(User).get(user_id)  # âŒ åŒæœŸå‡¦ç†
    return user

# âŒ awaitã—å¿˜ã‚Œ
async def process_users():
    users = get_all_users()  # âŒ awaitãŒãªã„
    for user in users:
        print(user.name)
```

**å•é¡Œç‚¹**:
- éåŒæœŸã®æ©æµã‚’å—ã‘ã‚‰ã‚Œãªã„
- awaitã—å¿˜ã‚Œã§ãƒã‚°

#### âœ… Good Example

```python
# âœ… éåŒæœŸå‡¦ç†ã‚’æ­£ã—ãä½¿ç”¨
async def get_user(user_id: int) -> Optional[User]:
    """éåŒæœŸã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å–å¾—"""
    async with async_session() as session:
        result = await session.execute(
            select(User).where(User.id == user_id)
        )
        return result.scalars().first()

# âœ… awaitã‚’ä½¿ç”¨
async def process_users():
    users = await get_all_users()  # âœ… awaitã‚’ä½¿ç”¨
    for user in users:
        print(user.name)
```

**æ”¹å–„ç‚¹**:
- âœ… éåŒæœŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨
- âœ… awaitã‚’å¿˜ã‚Œãšã«ä½¿ç”¨

---

### 6. ä¾å­˜æ€§æ³¨å…¥

#### âŒ Bad Example

```python
# âŒ ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸä¾å­˜é–¢ä¿‚
class UserService:
    def __init__(self):
        self.repository = UserRepository()  # âŒ ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰

    async def get_user(self, user_id: int):
        return await self.repository.find_by_id(user_id)
```

**å•é¡Œç‚¹**:
- ãƒ†ã‚¹ãƒˆãŒå›°é›£
- ãƒ¢ãƒƒã‚¯ã§ããªã„
- æŸ”è»Ÿæ€§ãŒãªã„

#### âœ… Good Example

```python
# âœ… ä¾å­˜æ€§æ³¨å…¥ã‚’ä½¿ç”¨
class UserService:
    def __init__(self, repository: UserRepository):
        self.repository = repository  # âœ… å¤–éƒ¨ã‹ã‚‰æ³¨å…¥

    async def get_user(self, user_id: int) -> Optional[User]:
        return await self.repository.find_by_id(user_id)

# ãƒ†ã‚¹ãƒˆæ™‚ã«ãƒ¢ãƒƒã‚¯ã‚’æ³¨å…¥å¯èƒ½
mock_repo = AsyncMock(spec=UserRepository)
service = UserService(mock_repo)
```

**æ”¹å–„ç‚¹**:
- âœ… ãƒ†ã‚¹ãƒˆå®¹æ˜“
- âœ… ãƒ¢ãƒƒã‚¯å¯èƒ½
- âœ… æŸ”è»Ÿæ€§å‘ä¸Š

---

### 7. ç’°å¢ƒå¤‰æ•°ãƒ»ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç®¡ç†

#### âŒ Bad Example

```python
# âŒ ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰
DATABASE_URL = "postgresql://user:password@localhost/db"

# âŒ .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒŸãƒƒãƒˆ
# .env
DATABASE_URL=postgresql://user:password@localhost/db  # âŒ Gitç®¡ç†
```

**å•é¡Œç‚¹**:
- ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãŒæ¼æ´©
- ç’°å¢ƒã”ã¨ã«å¤‰æ›´ãŒå¿…è¦

#### âœ… Good Example

```python
# âœ… ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ç”¨
import os
from dotenv import load_dotenv

load_dotenv()

DATABASE_URL = os.getenv("DATABASE_URL")
if DATABASE_URL is None:
    raise ValueError("DATABASE_URL is not set")

# âœ… .gitignore ã« .env ã‚’è¿½åŠ 
# .gitignore
.env          # âœ… Gitç®¡ç†ã—ãªã„
.env.local

# âœ… .env.example ã‚’æä¾›
# .env.example
DATABASE_URL=postgresql://user:password@localhost/db
```

**æ”¹å–„ç‚¹**:
- âœ… ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ç”¨
- âœ… .envã‚’Gitç®¡ç†ã—ãªã„
- âœ… .env.exampleã§é››å½¢æä¾›

---

### 8. ãƒ†ã‚¹ãƒˆ

#### âŒ Bad Example

```python
# âŒ AAAãƒ‘ã‚¿ãƒ¼ãƒ³ãªã—
def test_get_user():
    result = service.get_user(1)
    assert result.name == "Test"

# âŒ ãƒ¢ãƒƒã‚¯ãªã—ï¼ˆå®Ÿéš›ã®DBã«ã‚¢ã‚¯ã‚»ã‚¹ï¼‰
def test_get_user_from_db():
    result = UserService().get_user(1)  # âŒ å®ŸDB
    assert result is not None
```

**å•é¡Œç‚¹**:
- å¯èª­æ€§ãŒä½ã„
- ãƒ†ã‚¹ãƒˆãŒé…ã„

#### âœ… Good Example

```python
import pytest
from unittest.mock import AsyncMock

@pytest.mark.asyncio
async def test_get_user_success():
    """ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—æˆåŠŸã®ãƒ†ã‚¹ãƒˆ"""
    # Arrange: ãƒ¢ãƒƒã‚¯ã®æº–å‚™
    mock_repo = AsyncMock()
    mock_repo.find_by_id.return_value = User(
        id=1, name="Test User", email="test@example.com"
    )

    # Act: ã‚µãƒ¼ãƒ“ã‚¹ã®å®Ÿè¡Œ
    service = UserService(mock_repo)
    result = await service.get_user(1)

    # Assert: çµæœã®æ¤œè¨¼
    assert result.id == 1
    assert result.name == "Test User"
```

**æ”¹å–„ç‚¹**:
- âœ… AAAãƒ‘ã‚¿ãƒ¼ãƒ³
- âœ… ãƒ¢ãƒƒã‚¯ä½¿ç”¨ï¼ˆé«˜é€Ÿï¼‰

---

## ğŸ“ ã¾ã¨ã‚

### å¿…ãšå®ˆã‚‹ã¹ãã“ã¨ â­â­â­

1. **å‹ãƒ’ãƒ³ãƒˆ**: ã™ã¹ã¦ã®é–¢æ•°ã«å‹ãƒ’ãƒ³ãƒˆ
2. **ã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–**: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®ã‚¨ãƒ©ãƒ¼ã¯ã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–
3. **docstring**: Google Style docstring
4. **å±¤åˆ¥è¨­è¨ˆ**: api, models, services, repositories
5. **ç’°å¢ƒå¤‰æ•°**: ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¯ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã—ãªã„
6. **ãƒ†ã‚¹ãƒˆ**: AAAãƒ‘ã‚¿ãƒ¼ãƒ³ã€ãƒ¢ãƒƒã‚¯ä½¿ç”¨ã€ã‚«ãƒãƒ¬ãƒƒã‚¸80%ä»¥ä¸Š

---

**ä½œæˆæ—¥**: 2025-10-19
**å¯¾è±¡ãƒ•ã‚§ãƒ¼ã‚º**: å®Ÿè£…
**é‡è¦åº¦**: â­â­â­ å¿…é ˆ
