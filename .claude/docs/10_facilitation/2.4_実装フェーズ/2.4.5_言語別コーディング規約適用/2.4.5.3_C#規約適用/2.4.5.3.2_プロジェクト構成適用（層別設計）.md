# 2.4.5.3.2 C#ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆé©ç”¨ï¼ˆå±¤åˆ¥è¨­è¨ˆï¼‰

## ç›®çš„

`.claude/docs/40_standards/43_csharp.md` ã«æº–æ‹ ã—ãŸC# .NET Coreãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆï¼ˆClean Architectureï¼‰ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

---

## ğŸ“ æ¨™æº–ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```
MySolution/
â”œâ”€â”€ MySolution.sln
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ MyApp.API/              # Web APIå±¤
â”‚   â”‚   â”œâ”€â”€ Controllers/
â”‚   â”‚   â”œâ”€â”€ Program.cs
â”‚   â”‚   â””â”€â”€ appsettings.json
â”‚   â”œâ”€â”€ MyApp.Application/      # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤
â”‚   â”‚   â”œâ”€â”€ Services/
â”‚   â”‚   â”œâ”€â”€ Interfaces/
â”‚   â”‚   â””â”€â”€ DTOs/
â”‚   â”œâ”€â”€ MyApp.Domain/           # ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤
â”‚   â”‚   â”œâ”€â”€ Entities/
â”‚   â”‚   â”œâ”€â”€ Interfaces/
â”‚   â”‚   â””â”€â”€ Exceptions/
â”‚   â””â”€â”€ MyApp.Infrastructure/   # ã‚¤ãƒ³ãƒ•ãƒ©å±¤
â”‚       â”œâ”€â”€ Data/
â”‚       â”œâ”€â”€ Repositories/
â”‚       â””â”€â”€ ExternalServices/
â””â”€â”€ tests/
    â”œâ”€â”€ MyApp.UnitTests/
    â””â”€â”€ MyApp.IntegrationTests/
```

---

## âœ… å„å±¤ã®å½¹å‰²

### 1. APIå±¤ï¼ˆWeb APIï¼‰ â­â­â­

**è²¬å‹™**:
- HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å—ä»˜
- Applicationå±¤ã®å‘¼ã³å‡ºã—
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®è¿”å´

**ä¾‹**:

```csharp
// Controllers/UserController.cs
using Microsoft.AspNetCore.Mvc;
using MyApp.Application.Interfaces;
using MyApp.Application.DTOs;

namespace MyApp.API.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class UserController : ControllerBase
    {
        private readonly IUserService _userService;

        public UserController(IUserService userService)
        {
            _userService = userService;
        }

        [HttpGet("{id}")]
        public async Task<ActionResult<UserDto>> GetUser(int id)
        {
            var user = await _userService.GetUserAsync(id);
            if (user == null)
            {
                return NotFound();
            }
            return Ok(user);
        }
    }
}
```

---

### 2. Applicationå±¤ï¼ˆUse Casesï¼‰ â­â­â­

**è²¬å‹™**:
- ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…
- Domainå±¤ã¨Infrastructureå±¤ã®èª¿æ•´
- DTOã®å¤‰æ›

**ä¾‹**:

```csharp
// Services/UserService.cs
using MyApp.Application.Interfaces;
using MyApp.Application.DTOs;
using MyApp.Domain.Interfaces;

namespace MyApp.Application.Services
{
    public class UserService : IUserService
    {
        private readonly IUserRepository _userRepository;

        public UserService(IUserRepository userRepository)
        {
            _userRepository = userRepository;
        }

        public async Task<UserDto?> GetUserAsync(int id)
        {
            var user = await _userRepository.GetByIdAsync(id);
            if (user == null) return null;

            return new UserDto
            {
                Id = user.Id,
                Name = user.Name,
                Email = user.Email
            };
        }
    }
}
```

---

### 3. Domainå±¤ï¼ˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã€ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ï¼‰ â­â­â­

**è²¬å‹™**:
- ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®å®šç¾©
- ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«
- ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®å®šç¾©

**ä¾‹**:

```csharp
// Entities/User.cs
namespace MyApp.Domain.Entities
{
    public class User
    {
        public int Id { get; set; }
        public string Name { get; set; } = string.Empty;
        public string Email { get; set; } = string.Empty;
        public DateTime CreatedAt { get; set; }

        // ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
        public bool IsEmailValid()
        {
            return Email.Contains("@");
        }
    }
}

// Interfaces/IUserRepository.cs
namespace MyApp.Domain.Interfaces
{
    public interface IUserRepository
    {
        Task<User?> GetByIdAsync(int id);
        Task<User> CreateAsync(User user);
    }
}
```

---

### 4. Infrastructureå±¤ï¼ˆDBã€å¤–éƒ¨APIï¼‰ â­â­â­

**è²¬å‹™**:
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹
- å¤–éƒ¨APIã‚¢ã‚¯ã‚»ã‚¹
- Repositoryã®å®Ÿè£…

**ä¾‹**:

```csharp
// Repositories/UserRepository.cs
using MyApp.Domain.Entities;
using MyApp.Domain.Interfaces;
using Microsoft.EntityFrameworkCore;

namespace MyApp.Infrastructure.Repositories
{
    public class UserRepository : IUserRepository
    {
        private readonly AppDbContext _context;

        public UserRepository(AppDbContext context)
        {
            _context = context;
        }

        public async Task<User?> GetByIdAsync(int id)
        {
            return await _context.Users.FindAsync(id);
        }

        public async Task<User> CreateAsync(User user)
        {
            _context.Users.Add(user);
            await _context.SaveChangesAsync();
            return user;
        }
    }
}
```

---

## ğŸ“¦ DIç™»éŒ²ï¼ˆProgram.csï¼‰

```csharp
// Program.cs
using MyApp.Application.Interfaces;
using MyApp.Application.Services;
using MyApp.Domain.Interfaces;
using MyApp.Infrastructure.Data;
using MyApp.Infrastructure.Repositories;
using Microsoft.EntityFrameworkCore;

var builder = WebApplication.CreateBuilder(args);

// Add services to the container
builder.Services.AddControllers();

// DIç™»éŒ²
builder.Services.AddDbContext<AppDbContext>(options =>
    options.UseNpgsql(builder.Configuration.GetConnectionString("DefaultConnection")));

builder.Services.AddScoped<IUserRepository, UserRepository>();
builder.Services.AddScoped<IUserService, UserService>();

var app = builder.Build();

app.MapControllers();
app.Run();
```

---

## âŒ Bad Example: å±¤åˆ¥è¨­è¨ˆãªã—

```
MyApp/
â”œâ”€â”€ Controllers/
â”œâ”€â”€ Models/
â””â”€â”€ Database/
```

**å•é¡Œç‚¹**:
- å±¤åˆ¥è¨­è¨ˆãŒãªã„
- ãƒ†ã‚¹ãƒˆãŒå›°é›£
- ä¿å®ˆæ€§ãŒä½ã„

---

## âœ… Good Example: Clean Architecture

```
MySolution/
â”œâ”€â”€ MyApp.API/          # âœ… Web APIå±¤
â”œâ”€â”€ MyApp.Application/  # âœ… Use Caseså±¤
â”œâ”€â”€ MyApp.Domain/       # âœ… ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤
â””â”€â”€ MyApp.Infrastructure/ # âœ… ã‚¤ãƒ³ãƒ•ãƒ©å±¤
```

**æ”¹å–„ç‚¹**:
- âœ… å±¤åˆ¥è¨­è¨ˆ
- âœ… ä¾å­˜é–¢ä¿‚ãŒæ˜ç¢º
- âœ… ãƒ†ã‚¹ãƒˆãŒå®¹æ˜“

---

**ä½œæˆæ—¥**: 2025-10-19
**å¯¾è±¡ãƒ•ã‚§ãƒ¼ã‚º**: å®Ÿè£…
**é‡è¦åº¦**: â­â­â­ å¿…é ˆ
