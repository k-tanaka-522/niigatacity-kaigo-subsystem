# 2.4.5.3.6 C# Good_Bad_Exampleé›†

## ç›®çš„

C# .NET Coreå®Ÿè£…ã®ã‚ˆãã‚ã‚‹é–“é•ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨æ¨å¥¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç¤ºã—ã¾ã™ã€‚

---

## ğŸ”„ å®Ÿä¾‹ãƒ‘ã‚¿ãƒ¼ãƒ³é›†

### 1. DIï¼ˆä¾å­˜æ€§æ³¨å…¥ï¼‰

#### âŒ Bad Example

```csharp
// âŒ new ã§ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–
public class UserController : ControllerBase
{
    private readonly UserService _userService = new UserService(new UserRepository());

    [HttpGet("{id}")]
    public async Task<ActionResult<UserDto>> GetUser(int id)
    {
        return Ok(await _userService.GetUserAsync(id));
    }
}
```

**å•é¡Œç‚¹**:
- ãƒ†ã‚¹ãƒˆãŒå›°é›£
- ãƒ¢ãƒƒã‚¯ã§ããªã„

#### âœ… Good Example

```csharp
// âœ… DIã§æ³¨å…¥
public class UserController : ControllerBase
{
    private readonly IUserService _userService;

    public UserController(IUserService userService)
    {
        _userService = userService;
    }

    [HttpGet("{id}")]
    public async Task<ActionResult<UserDto>> GetUser(int id)
    {
        var user = await _userService.GetUserAsync(id);
        return user != null ? Ok(user) : NotFound();
    }
}
```

**æ”¹å–„ç‚¹**:
- âœ… ãƒ†ã‚¹ãƒˆå®¹æ˜“
- âœ… ãƒ¢ãƒƒã‚¯å¯èƒ½

---

### 2. éåŒæœŸå‡¦ç†

#### âŒ Bad Example

```csharp
// âŒ .Result ã§åŒæœŸçš„ã«å¾…ã¤ï¼ˆãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ã®ãƒªã‚¹ã‚¯ï¼‰
public UserDto GetUser(int id)
{
    var user = _userRepository.GetByIdAsync(id).Result;  // âŒ å±é™º
    return MapToDto(user);
}

// âŒ async voidã‚’ä½¿ç”¨ï¼ˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ä»¥å¤–ï¼‰
public async void ProcessUser(int id)  // âŒ é¿ã‘ã‚‹
{
    await _userRepository.GetByIdAsync(id);
}
```

**å•é¡Œç‚¹**:
- ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ã®ãƒªã‚¹ã‚¯
- ä¾‹å¤–å‡¦ç†ãŒå›°é›£

#### âœ… Good Example

```csharp
// âœ… async/await ã‚’ä½¿ç”¨
public async Task<UserDto> GetUserAsync(int id)
{
    var user = await _userRepository.GetByIdAsync(id);
    return MapToDto(user);
}

// âœ… async Task ã‚’ä½¿ç”¨
public async Task ProcessUserAsync(int id)
{
    await _userRepository.GetByIdAsync(id);
}
```

**æ”¹å–„ç‚¹**:
- âœ… ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ãªã—
- âœ… ä¾‹å¤–å‡¦ç†ãŒå®¹æ˜“

---

### 3. ä¾‹å¤–å‡¦ç†

#### âŒ Bad Example

```csharp
// âŒ try-catchãªã—
public async Task<UserDto> GetUserAsync(int id)
{
    var user = await _userRepository.GetByIdAsync(id);
    return MapToDto(user);
}

// âŒ æ±ç”¨çš„ãªException
if (user == null)
{
    throw new Exception("Error");  // âŒ ä¸æ˜ç­
}
```

**å•é¡Œç‚¹**:
- ã‚¨ãƒ©ãƒ¼å‡¦ç†ãŒãªã„
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒä¸æ˜ç­

#### âœ… Good Example

```csharp
// âœ… ã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤– + try-catch
public async Task<UserDto> GetUserAsync(int id)
{
    try
    {
        var user = await _userRepository.GetByIdAsync(id);
        if (user == null)
        {
            _logger.LogWarning("User {UserId} not found", id);
            throw new UserNotFoundException(id);
        }
        return MapToDto(user);
    }
    catch (UserNotFoundException)
    {
        throw;
    }
    catch (Exception ex)
    {
        _logger.LogError(ex, "Failed to get user {UserId}", id);
        throw;
    }
}
```

**æ”¹å–„ç‚¹**:
- âœ… ã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–
- âœ… ãƒ­ã‚°å‡ºåŠ›

---

### 4. Nullå®‰å…¨æ€§

#### âŒ Bad Example

```csharp
// âŒ nullãƒã‚§ãƒƒã‚¯ãªã—
public string GetUserName(User user)
{
    return user.Name;  // âŒ NullReferenceException
}
```

**å•é¡Œç‚¹**:
- Nullå‚ç…§ã‚¨ãƒ©ãƒ¼

#### âœ… Good Example

```csharp
// âœ… nullãƒã‚§ãƒƒã‚¯ + Nullable Reference Types
public string? GetUserName(User? user)
{
    return user?.Name;
}

// âœ… Nullåˆä½“æ¼”ç®—å­
public string GetUserNameOrDefault(User? user)
{
    return user?.Name ?? "Unknown";
}
```

**æ”¹å–„ç‚¹**:
- âœ… Nullå®‰å…¨

---

### 5. ç’°å¢ƒå¤‰æ•°ãƒ»è¨­å®šç®¡ç†

#### âŒ Bad Example

```csharp
// âŒ ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰
var connectionString = "Server=localhost;Database=mydb;User=admin;Password=secret";
```

**å•é¡Œç‚¹**:
- ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆæ¼æ´©

#### âœ… Good Example

```csharp
// âœ… appsettings.json + ç’°å¢ƒå¤‰æ•°
// appsettings.json
{
  "ConnectionStrings": {
    "DefaultConnection": "Server=localhost;Database=mydb"
  }
}

// Program.cs
var connectionString = builder.Configuration.GetConnectionString("DefaultConnection");
```

**æ”¹å–„ç‚¹**:
- âœ… ç’°å¢ƒå¤‰æ•°ä½¿ç”¨
- âœ… ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆåˆ†é›¢

---

### 6. ãƒ†ã‚¹ãƒˆ

#### âŒ Bad Example

```csharp
// âŒ ãƒ¢ãƒƒã‚¯ãªã—
[Fact]
public async Task TestGetUser()
{
    var service = new UserService(new UserRepository());  // âŒ å®ŸDB
    var result = await service.GetUserAsync(1);
    Assert.NotNull(result);
}
```

**å•é¡Œç‚¹**:
- ãƒ†ã‚¹ãƒˆãŒé…ã„

#### âœ… Good Example

```csharp
// âœ… ãƒ¢ãƒƒã‚¯ä½¿ç”¨
[Fact]
public async Task GetUserAsync_WhenUserExists_ReturnsUserDto()
{
    // Arrange
    var mockRepo = new Mock<IUserRepository>();
    mockRepo.Setup(x => x.GetByIdAsync(1)).ReturnsAsync(new User { Id = 1, Name = "Test" });
    var service = new UserService(mockRepo.Object);

    // Act
    var result = await service.GetUserAsync(1);

    // Assert
    result.Should().NotBeNull();
}
```

**æ”¹å–„ç‚¹**:
- âœ… ãƒ¢ãƒƒã‚¯ä½¿ç”¨
- âœ… é«˜é€Ÿ

---

## ğŸ“ ã¾ã¨ã‚

### å¿…ãšå®ˆã‚‹ã¹ãã“ã¨ â­â­â­

1. **DI**: ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³
2. **async/await**: éåŒæœŸå‡¦ç†
3. **ä¾‹å¤–å‡¦ç†**: ã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤– + try-catch
4. **Nullå®‰å…¨æ€§**: Nullable Reference Types
5. **ç’°å¢ƒå¤‰æ•°**: appsettings.json
6. **ãƒ†ã‚¹ãƒˆ**: Moq + xUnit

---

**ä½œæˆæ—¥**: 2025-10-19
**å¯¾è±¡ãƒ•ã‚§ãƒ¼ã‚º**: å®Ÿè£…
**é‡è¦åº¦**: â­â­â­ å¿…é ˆ
