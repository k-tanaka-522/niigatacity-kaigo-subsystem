# 2.4.5.2.6 TypeScript Good_Bad_Exampleé›†

## ç›®çš„

TypeScriptå®Ÿè£…ã®ã‚ˆãã‚ã‚‹é–“é•ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨æ¨å¥¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç¤ºã—ã¾ã™ã€‚

---

## ğŸ”„ å®Ÿä¾‹ãƒ‘ã‚¿ãƒ¼ãƒ³é›†

### 1. å‹å®šç¾©

#### âŒ Bad Example

```typescript
// âŒ anyå‹ã‚’ä½¿ç”¨
function getUser(userId: any): any {
  return db.query(userId);
}

// âŒ å‹å®šç¾©ãªã—
function processData(data) {
  return data.map(item => item.value);
}
```

**å•é¡Œç‚¹**:
- å‹å®‰å…¨æ€§ãŒãªã„
- ã‚¨ãƒ‡ã‚£ã‚¿ã®è£œå®ŒãŒåŠ¹ã‹ãªã„
- ãƒã‚°ãŒæ··å…¥ã—ã‚„ã™ã„

#### âœ… Good Example

```typescript
// âœ… interface ã«ã‚ˆã‚‹å‹å®šç¾©
interface User {
  id: number;
  name: string;
  email: string;
}

function getUser(userId: number): Promise<User | null> {
  return db.query<User>('SELECT * FROM users WHERE id = $1', [userId]);
}

// âœ… ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹ã§å‹å®‰å…¨
function processData<T>(data: T[], key: keyof T): T[keyof T][] {
  return data.map(item => item[key]);
}
```

**æ”¹å–„ç‚¹**:
- âœ… å‹å®‰å…¨æ€§
- âœ… ã‚¨ãƒ‡ã‚£ã‚¿ã®è£œå®ŒãŒåŠ¹ã
- âœ… ãƒã‚°ã‚’æœªç„¶ã«é˜²ã

---

### 2. éåŒæœŸå‡¦ç†

#### âŒ Bad Example

```typescript
// âŒ awaitã—å¿˜ã‚Œ
async function processUser(userId: number) {
  const user = getUser(userId);  // âŒ Promise<User>
  console.log(user.name);  // âŒ Error
}

// âŒ ç›´åˆ—å®Ÿè¡Œï¼ˆé…ã„ï¼‰
async function getUsers(userIds: number[]) {
  const users = [];
  for (const id of userIds) {
    users.push(await getUser(id));  // âŒ 1ã¤ãšã¤å®Ÿè¡Œ
  }
  return users;
}
```

**å•é¡Œç‚¹**:
- awaitã—å¿˜ã‚Œã§ãƒã‚°
- ç›´åˆ—å®Ÿè¡Œã§é…ã„

#### âœ… Good Example

```typescript
// âœ… awaitã‚’ä½¿ç”¨
async function processUser(userId: number): Promise<void> {
  const user = await getUser(userId);
  console.log(user.name);
}

// âœ… ä¸¦åˆ—å®Ÿè¡Œ
async function getUsers(userIds: number[]): Promise<User[]> {
  return Promise.all(userIds.map(id => getUser(id)));
}
```

**æ”¹å–„ç‚¹**:
- âœ… awaitã‚’æ­£ã—ãä½¿ç”¨
- âœ… ä¸¦åˆ—å®Ÿè¡Œã§é«˜é€ŸåŒ–

---

### 3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

#### âŒ Bad Example

```typescript
// âŒ try-catchãªã—
async function getUser(userId: number) {
  const user = await db.query(userId);
  return user;
}

// âŒ æ±ç”¨çš„ãªError
if (!user) {
  throw new Error('Error');  // âŒ ä½•ã®ã‚¨ãƒ©ãƒ¼ã‹ä¸æ˜
}
```

**å•é¡Œç‚¹**:
- ã‚¨ãƒ©ãƒ¼å‡¦ç†ãŒãªã„
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒä¸æ˜ç­

#### âœ… Good Example

```typescript
// âœ… ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼ã‚¯ãƒ©ã‚¹
class UserNotFoundError extends Error {
  constructor(public userId: number) {
    super(`User ${userId} not found`);
    this.name = 'UserNotFoundError';
  }
}

// âœ… try-catch + ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼
async function getUser(userId: number): Promise<User> {
  try {
    const user = await db.query<User>('SELECT * FROM users WHERE id = $1', [userId]);
    if (!user) {
      throw new UserNotFoundError(userId);
    }
    return user;
  } catch (error) {
    logger.error(`Failed to get user ${userId}:`, error);
    throw error;
  }
}
```

**æ”¹å–„ç‚¹**:
- âœ… ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼ã§æ„å›³ãŒæ˜ç¢º
- âœ… ãƒ­ã‚°å‡ºåŠ›
- âœ… try-catchã§ã‚¨ãƒ©ãƒ¼å‡¦ç†

---

### 4. Null/Undefined ãƒã‚§ãƒƒã‚¯

#### âŒ Bad Example

```typescript
// âŒ nullãƒã‚§ãƒƒã‚¯ãªã—
function getUserName(user: User | null): string {
  return user.name;  // âŒ Error: Object is possibly 'null'
}

// âŒ å‹ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ä¹±ç”¨
function getUserName2(user: User | null): string {
  return (user as User).name;  // âŒ å±é™º
}
```

**å•é¡Œç‚¹**:
- Nullå‚ç…§ã‚¨ãƒ©ãƒ¼
- å‹ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã§å‹å®‰å…¨æ€§ã‚’ç„¡è¦–

#### âœ… Good Example

```typescript
// âœ… nullãƒã‚§ãƒƒã‚¯
function getUserName(user: User | null): string | null {
  if (!user) {
    return null;
  }
  return user.name;
}

// âœ… Optional Chaining
function getUserEmail(user: User | null): string | undefined {
  return user?.email;
}

// âœ… Nullish Coalescing
function getUserNameOrDefault(user: User | null): string {
  return user?.name ?? 'Unknown';
}
```

**æ”¹å–„ç‚¹**:
- âœ… null/undefinedã‚’å®‰å…¨ã«å‡¦ç†
- âœ… Optional Chaining/Nullish Coalescing ã‚’æ´»ç”¨

---

### 5. å‹ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³

#### âŒ Bad Example

```typescript
// âŒ as any ã§å‹å®‰å…¨æ€§ã‚’ç„¡è¦–
const data = JSON.parse(jsonString) as any;
console.log(data.name);  // âŒ å‹ãƒã‚§ãƒƒã‚¯ãªã—

// âŒ å±é™ºãªå‹ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³
const user = {} as User;  // âŒ ç©ºã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’Userã¨ã—ã¦æ‰±ã†
console.log(user.name);  // undefined
```

**å•é¡Œç‚¹**:
- å‹å®‰å…¨æ€§ã‚’ç„¡è¦–
- ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼ã®ãƒªã‚¹ã‚¯

#### âœ… Good Example

```typescript
// âœ… å‹ã‚¬ãƒ¼ãƒ‰ã‚’ä½¿ç”¨
interface User {
  id: number;
  name: string;
  email: string;
}

function isUser(obj: unknown): obj is User {
  return (
    typeof obj === 'object' &&
    obj !== null &&
    'id' in obj &&
    typeof obj.id === 'number' &&
    'name' in obj &&
    typeof obj.name === 'string'
  );
}

const data = JSON.parse(jsonString);
if (isUser(data)) {
  console.log(data.name);  // âœ… å‹å®‰å…¨
}

// âœ… Zodãªã©ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
import { z } from 'zod';

const UserSchema = z.object({
  id: z.number(),
  name: z.string(),
  email: z.string().email(),
});

const user = UserSchema.parse(JSON.parse(jsonString));  // âœ… å‹å®‰å…¨
```

**æ”¹å–„ç‚¹**:
- âœ… å‹ã‚¬ãƒ¼ãƒ‰ã§å®‰å…¨ã«å‹ã‚’ç¢ºèª
- âœ… ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§å‹å®‰å…¨æ€§ã‚’ä¿è¨¼

---

### 6. ç’°å¢ƒå¤‰æ•°ãƒ»è¨­å®šç®¡ç†

#### âŒ Bad Example

```typescript
// âŒ ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰
const DATABASE_URL = 'postgresql://user:password@localhost/db';

// âŒ å‹ãƒã‚§ãƒƒã‚¯ãªã—
const PORT = process.env.PORT;  // string | undefined
app.listen(PORT);  // âŒ Error
```

**å•é¡Œç‚¹**:
- ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãŒãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰
- ç’°å¢ƒå¤‰æ•°ã®å‹ãŒä¸æ˜

#### âœ… Good Example

```typescript
// âœ… ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ç”¨ + å‹å®‰å…¨
import dotenv from 'dotenv';
dotenv.config();

function getEnv(key: string): string {
  const value = process.env[key];
  if (!value) {
    throw new Error(`Environment variable ${key} is not set`);
  }
  return value;
}

const DATABASE_URL = getEnv('DATABASE_URL');
const PORT = parseInt(getEnv('PORT'), 10);

app.listen(PORT, () => {
  console.log(`Server running on port ${PORT}`);
});
```

**æ”¹å–„ç‚¹**:
- âœ… ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ç”¨
- âœ… å‹å®‰å…¨æ€§ã‚’ç¢ºä¿
- âœ… æœªè¨­å®šæ™‚ã«ã‚¨ãƒ©ãƒ¼

---

### 7. ãƒ†ã‚¹ãƒˆ

#### âŒ Bad Example

```typescript
// âŒ AAAãƒ‘ã‚¿ãƒ¼ãƒ³ãªã—
test('get user', async () => {
  const result = await service.getUser(1);
  expect(result.name).toBe('Test');
});

// âŒ ãƒ¢ãƒƒã‚¯ãªã—
test('get user', async () => {
  const service = new UserService();
  const result = await service.getUser(1);  // âŒ å®ŸDB
  expect(result).toBeTruthy();
});
```

**å•é¡Œç‚¹**:
- å¯èª­æ€§ãŒä½ã„
- ãƒ†ã‚¹ãƒˆãŒé…ã„

#### âœ… Good Example

```typescript
import { UserService } from '../src/services/userService';
import { UserRepository } from '../src/repositories/userRepository';

jest.mock('../src/repositories/userRepository');

describe('UserService', () => {
  let userService: UserService;
  let mockUserRepository: jest.Mocked<UserRepository>;

  beforeEach(() => {
    mockUserRepository = new UserRepository() as jest.Mocked<UserRepository>;
    userService = new UserService(mockUserRepository);
  });

  test('should return user when user exists', async () => {
    // Arrange
    const mockUser = { id: 1, name: 'Test', email: 'test@example.com' };
    mockUserRepository.findById.mockResolvedValue(mockUser);

    // Act
    const result = await userService.getUser(1);

    // Assert
    expect(result).toEqual(mockUser);
  });
});
```

**æ”¹å–„ç‚¹**:
- âœ… AAAãƒ‘ã‚¿ãƒ¼ãƒ³
- âœ… ãƒ¢ãƒƒã‚¯ä½¿ç”¨ï¼ˆé«˜é€Ÿï¼‰

---

### 8. ä¾å­˜æ€§æ³¨å…¥

#### âŒ Bad Example

```typescript
// âŒ ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸä¾å­˜é–¢ä¿‚
class UserService {
  private repository = new UserRepository();  // âŒ ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰

  async getUser(userId: number) {
    return this.repository.findById(userId);
  }
}
```

**å•é¡Œç‚¹**:
- ãƒ†ã‚¹ãƒˆãŒå›°é›£
- ãƒ¢ãƒƒã‚¯ã§ããªã„

#### âœ… Good Example

```typescript
// âœ… ä¾å­˜æ€§æ³¨å…¥
class UserService {
  constructor(private repository: UserRepository) {}

  async getUser(userId: number): Promise<User> {
    return this.repository.findById(userId);
  }
}

// ãƒ†ã‚¹ãƒˆæ™‚ã«ãƒ¢ãƒƒã‚¯ã‚’æ³¨å…¥å¯èƒ½
const mockRepo = new UserRepository() as jest.Mocked<UserRepository>;
const service = new UserService(mockRepo);
```

**æ”¹å–„ç‚¹**:
- âœ… ãƒ†ã‚¹ãƒˆå®¹æ˜“
- âœ… ãƒ¢ãƒƒã‚¯å¯èƒ½

---

## ğŸ“ ã¾ã¨ã‚

### å¿…ãšå®ˆã‚‹ã¹ãã“ã¨ â­â­â­

1. **å‹å®šç¾©**: anyå‹ã‚’é¿ã‘ã€interfaceã‚„typeã‚’ä½¿ç”¨
2. **async/await**: éåŒæœŸå‡¦ç†ã¯ async/awaitã€ä¸¦åˆ—å‡¦ç†ã¯ Promise.all
3. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: try-catch + ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼ã‚¯ãƒ©ã‚¹
4. **Null/Undefined**: Optional Chainingã€Nullish Coalescing ã‚’æ´»ç”¨
5. **ç’°å¢ƒå¤‰æ•°**: ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã›ãšã€ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ç”¨
6. **ãƒ†ã‚¹ãƒˆ**: AAAãƒ‘ã‚¿ãƒ¼ãƒ³ã€ãƒ¢ãƒƒã‚¯ä½¿ç”¨ã€ã‚«ãƒãƒ¬ãƒƒã‚¸80%ä»¥ä¸Š

---

**ä½œæˆæ—¥**: 2025-10-19
**å¯¾è±¡ãƒ•ã‚§ãƒ¼ã‚º**: å®Ÿè£…
**é‡è¦åº¦**: â­â­â­ å¿…é ˆ
